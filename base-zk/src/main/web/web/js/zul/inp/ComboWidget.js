zul.inp.ComboWidget=zk.$extends(zul.inp.InputWidget,{_buttonVisible:true,setButtonVisible:(function(a,b){return function(c,d){var e=this[a];this[a]=c;if(e!==c||(d&&d.force)){this.__fname__=a.substring(1);b.apply(this,arguments);delete this.__fname__}return this}})("_buttonVisible",(function(a){zul.inp.RoundUtl.buttonVisible(this,a)})),getButtonVisible:_zkf$=function(){return this._buttonVisible},isButtonVisible:_zkf$,setAutodrop:(function(a){return function(b){this[a]=b;return this}})("_autodrop"),getAutodrop:_zkf$=function(){return this._autodrop},isAutodrop:_zkf$,setWidth:function(){this.$supers("setWidth",arguments);if(this.desktop){this.onSize()}},onSize:function(){zul.inp.RoundUtl.onSize(this)},onFloatUp:function(b){if((!this._inplace&&!this.isOpen())||jq(this.getPopupNode_()).is(":animated")){return}var c=b.origin;if(!zUtl.isAncestor(this,c)){if(this.isOpen()){this.close({sendOnOpen:true})}if(this._inplace){var d=this.$n(),a=this.getInplaceCSS();if(jq(d).hasClass(a)){return}d.style.width=jq.px0(zk(d).revisedWidth(d.offsetWidth));jq(this.getInputNode()).addClass(a);jq(d).addClass(a);this.onSize();d.style.width=this.getWidth()||""}}},onResponse:function(d,e){if((e.rtags.onOpen||e.rtags.onChanging)&&this.isOpen()){if(jq(this.getPopupNode_()).is(":animated")){var c=this;setTimeout(function(){c.onResponse(d,e)},50);return}var a=this.getPopupNode_(),b=this.getPopupSize_(a),f={};try{f.left=a.scrollLeft;f.Top=a.scrollTop;a.style.height="auto";if(zk.ie8){a.style.width=b[0]}this._fixsz(b)}finally{a.scrollTop=f.Top||0;a.scrollLeft=f.left||0}}},onScroll:function(b){if(this.isOpen()){if(b){var a=this.getInputNode();if(a&&zul.inp.InputWidget._isInView(this)){zk(this.getPopupNode_()).position(a,"after_start")}else{this.close()}}}},setOpen:function(a,b){if(this.isRealVisible()){if(a){this.open(b)}else{this.close(b)}}},isOpen:function(){return this._open},open:function(a){if(this._open){return}this._open=true;if(a&&a.focus){this.focus()}var b=this.getPopupNode_(),f=this.getInputNode();if(!b){return}this.setFloating_(true,{node:b});zWatch.fire("onFloatUp",this);var i=this.setTopmost();var g=this.getPopupSize_(b);b.style.width=g[0];b.style.height="auto";b.style.zIndex=i>0?i:1;var c=this.getPopupNode_(true);if(c){c.style.width=c.style.height="auto"}b.style.position="absolute";b.style.display="block";b.style.visibility="hidden";b.style.left="-10000px";var l=zk(b);l.makeVParent();zWatch.fireDown("onVParent",this);if(this.presize_()){g=this.getPopupSize_(b)}b.style.left="";this._fixsz(g);l.position(f,"after_start");if(this._checkPopupPosition()){l.position(f,"before_start")}b.style.display="none";b.style.visibility="";this.slideDown_(b);if(zk.gecko){var k=c?c.rows:null;if(k){var h=b.offsetHeight-b.clientHeight;if(h>10&&b.offsetHeight<150){var d=0;for(var e=k.length;e--;){d+=k[e].offsetHeight}b.style.height=(d+20)+"px"}}}if(!this._shadow){this._shadow=new zk.eff.Shadow(b,{left:-4,right:4,top:-2,bottom:3})}if(a&&a.sendOnOpen){this.fire("onOpen",{open:true,value:f.value},{rtags:{onOpen:1}})}jq(b).addClass(this.$s("open"))},_checkPopupPosition:function(){var c=this.getPopupNode_(),b=zk(c),f=this.getInputNode(),g=b.dimension(true),d=zk(f).dimension(true),a=g.top+g.height,e=d.top+d.height;if((a<e&&a>=d.top)||(g.top>=d.top&&g.top<e)||a>=jq.innerHeight()||(g.top<d.top&&a<d.top-2)){return this._shallSyncPopupPosition=true}return false},presize_:zk.$void,slideDown_:function(a){zk(a).slideDown(this,{afterAnima:this._afterSlideDown,duration:100})},slideUp_:function(a){a.style.display="none"},zsync:function(){this.$supers("zsync",arguments);if(!zk.css3&&this.isOpen()&&this._shadow){this._shadow.sync()}},_afterSlideDown:function(a){if(!this.desktop){zk(a).undoVParent();jq(a).remove()}if(this._shadow){this._shadow.sync()}},getPopupNode_:function(a){return a?this.$n("cave"):this.$n("pp")},close:function(c){if(!this._open){return}var b=this;if(jq(this.getPopupNode_()).is(":animated")){setTimeout(function(){b.close(c)},50);return}this._open=false;if(c&&c.focus){this.focus()}var a=this.getPopupNode_();if(!a){return}this.setFloating_(false);zWatch.fireDown("onHide",this);this.slideUp_(a);zk.afterAnimate(function(){zk(a).undoVParent();zWatch.fireDown("onVParent",b)},-1);if(this._shadow){this._shadow.destroy();this._shadow=null}if(c&&c.sendOnOpen){this.fire("onOpen",{open:false,value:this.getInputNode().value},{rtags:{onOpen:1}})}jq(a).removeClass(this.$s("open"))},_fixsz:function(d){var c=this.getPopupNode_();if(!c){return}var b=this.getPopupNode_(true);if(d[1]=="auto"&&c.offsetHeight>350){c.style.height="350px"}else{if(c.offsetHeight<10){c.style.height="10px";if(this._shadow){this._shadow.sync()}}}if(d[0]=="auto"){var a=this.$n();if(c.offsetWidth<=a.offsetWidth){c.style.width=zk(c).revisedWidth(a.offsetWidth)+"px";if(b){b.style.width="100%"}}else{var e=jq.innerWidth()-20;if(e<a.offsetWidth){e=a.offsetWidth}if(c.offsetWidth>e){c.style.width=e}}}},dnPressed_:zk.$void,upPressed_:zk.$void,otherPressed_:zk.$void,enterPressed_:function(a){this.close({sendOnOpen:true});this.updateChange_();a.stop()},escPressed_:function(a){this.close({sendOnOpen:true});a.stop()},getPopupSize_:function(a){return["auto","auto"]},redrawpp_:function(a){},beforeParentMinFlex_:function(a){if("w"==a){zul.inp.RoundUtl.syncWidth(this,this.$n("btn"))}},doFocus_:function(a){this.$supers("doFocus_",arguments);zul.inp.RoundUtl.doFocus_(this)},doBlur_:function(a){if(this._inplace&&this._open){return}this.$supers("doBlur_",arguments);zul.inp.RoundUtl.doBlur_(this)},afterKeyDown_:function(a,b){if(!b&&this._inplace){jq(this.$n()).toggleClass(this.getInplaceCSS(),a.keyCode==13?null:false)}return this.$supers("afterKeyDown_",arguments)},bind_:function(){this.$supers(zul.inp.ComboWidget,"bind_",arguments);var a,b=this.getInputNode();if(a=this.$n("btn")){this.domListen_(a,zk.android?"onTouchstart":"onClick","_doBtnClick")}zWatch.listen({onSize:this,onFloatUp:this,onResponse:this,onScroll:this});if(!zk.css3){jq.onzsync(this)}},unbind_:function(){this.close();var a=this.$n("btn");if(a){this.domUnlisten_(a,zk.android?"onTouchstart":"onClick","_doBtnClick")}zWatch.unlisten({onSize:this,onFloatUp:this,onResponse:this,onScroll:this});if(!zk.css3){jq.unzsync(this)}this.$supers(zul.inp.ComboWidget,"unbind_",arguments)},inRoundedMold:function(){return true},_doBtnClick:function(a){if(!this._buttonVisible){return}if(!this._disabled&&!jq(this.getPopupNode_()).is(":animated")){if(this._open){this.close({focus:zul.inp.InputCtrl.isPreservedFocus(this),sendOnOpen:true})}else{this.open({focus:zul.inp.InputCtrl.isPreservedFocus(this),sendOnOpen:true})}}if(zk.ios){this._windowX=window.pageXOffset;this._windowY=window.pageYOffset}a.stop({propagation:1})},doKeyDown_:function(a){this._doKeyDown(a);if(!a.stopped){this.$supers("doKeyDown_",arguments)}},doClick_:function(a){if(!this._disabled){if(a.domTarget==this.getPopupNode_()){this.close({focus:zul.inp.InputCtrl.isPreservedFocus(this),sendOnOpen:true})}else{if(this._readonly&&!this.isOpen()&&this._buttonVisible){this.open({focus:zul.inp.InputCtrl.isPreservedFocus(this),sendOnOpen:true})}}this.$supers("doClick_",arguments)}},_doKeyDown:function(a){var d=a.keyCode,b=this._open;if((a.target==this||!(a.target.$instanceof(zul.inp.InputWidget)))&&(d==9||(zk.webkit&&d==0))){if(b){this.close({sendOnOpen:true})}return}if(a.altKey&&(d==38||d==40)){if(b){this.close({sendOnOpen:true})}else{this.open({sendOnOpen:true})}var c={propagation:true};if(zk.ie<11){c.dom=true}a.stop(c);return}if(b&&(d==13||d==27)){if(d==13){this.enterPressed_(a)}else{this.escPressed_(a)}return}if(d==18||d==27||d==13||(d>=112&&d<=123)){return}if(this._autodrop&&!b){this.open({sendOnOpen:true})}if(d==38){this.upPressed_(a)}else{if(d==40){this.dnPressed_(a)}else{this.otherPressed_(a)}}},getIconClass_:zk.$void,redraw_:_zkf=function(a){var c=this.uuid,b=this._buttonVisible;a.push("<span",this.domAttrs_({text:true}),'><input id="',c,'-real" class="',this.$s("input"));if(!b){a.push(" ",this.$s("rightedge"))}a.push('" autocomplete="off"',this.textAttrs_(),'/><a id="',c,'-btn" class="',this.$s("button"));if(!b){a.push(" ",this.$s("disabled"))}a.push('"><i class="',this.$s("icon")," ",this.getIconClass_(),'"></i></a>');this.redrawpp_(a);a.push("</span>")}},{$redraw:_zkf});