(function(){var a={u:"up",d:"down",l:"left",r:"right"};zul.inp.Errorbox=zk.$extends(zul.wgt.Notification,{$init:function(b,c){this.parent=b;this.parent.__ebox=this;this.msg=c;this.$supers("$init",[c,{ref:parent}])},show:function(){jq(document.body).append(this);var b=this.parent._cst&&this.parent._cst._pos;var c=this,b=this.parent._cst&&this.parent._cst._pos;setTimeout(function(){if(c.parent&&zul.inp.InputWidget._isInView(c)){c.open(c.parent,null,b||"end_before",{dodgeRef:!b})}},50);zWatch.listen({onHide:[this.parent,this.onParentHide]})},destroy:function(){if(this.parent){zWatch.unlisten({onHide:[this.parent,this.onParentHide]});delete this.parent.__ebox}this.close();this.unbind();jq(this).remove();this.parent=null},onParentHide:function(){if(this.__ebox){this.__ebox.setFloating_(false);this.__ebox.close()}},bind_:function(){this.$supers(zul.inp.Errorbox,"bind_",arguments);var b=zul.inp.Errorbox;this._drag=new zk.Draggable(this,null,{starteffect:zk.$void,endeffect:b._enddrag,ignoredrag:b._ignoredrag,change:b._change});zWatch.listen({onScroll:this})},unbind_:function(){var b=this._drag;this._drag=null;if(b){b.destroy()}zWatch.unlisten({onScroll:this});if(this.parent){zWatch.unlisten({onHide:[this.parent,this.onParentHide]})}this.$supers(zul.inp.Errorbox,"unbind_",arguments)},getInputNode:function(){return this.parent?this.parent.$n():null},onScroll:function(b){if(b){if(zul.inp.InputWidget._isInView(this)){if(!this.isOpen()){this.open()}this.position(this.parent,null,"end_before",{overflow:true});this._fixarrow()}else{this.close()}}},setDomVisible_:function(c,d){this.$supers("setDomVisible_",arguments);var b=this._stackup;if(b){b.style.display=d?"":"none"}},doClick_:function(b){var c=b.domTarget;if(jq.contains(this.$n("cls"),c)){if((c=this.parent)&&c.clearErrorMessage){c.clearErrorMessage(true,true);c.focus(0)}else{zAu.wrongValue_(c,false)}}else{this.$supers("doClick_",arguments);this.parent.focus(0)}},open:function(){this.$supers("open",arguments);this.setTopmost();this._fixarrow()},afterCloseAnima_:function(b){this.setVisible(false);this.setFloating_(false);if(b&&b.sendOnOpen){this.fire("onOpen",{open:false})}},redraw:function(b){var d=this.uuid,c=this.$s("icon");b.push("<div",this.domAttrs_(),'><div id="',d,'-p" class="',this.$s("pointer"),'"></div><i id="',d,'-icon" class="',c,' z-icon-exclamation-triangle"></i><div id="',d,'-cave" class="',this.$s("content"),'" title="',(zUtl.encodeXML(msgzk.GOTO_ERROR_FIELD)),'">',zUtl.encodeXML(this.msg,{multiline:true}),'</div><div id="',d,'-cls" class="',this.$s("close"),'"><i class="',c,' z-icon-times"></i></div></div>')},onFloatUp:function(b){var e=b.origin;if(e==this){this.setTopmost();return}if(!e||e==this.parent||!this.isVisible()){return}var d=this,c=e;while((d=d.parent)&&!d.isFloating_()){if(d==e){return}}for(;c&&!c.isFloating_();c=c.parent){}if(d==c){var f=e.$n();if(f){this._uncover(f)}}},_uncover:function(b){var i=zk(b).cmOffset(),f=this.$n(),d=zk(f).cmOffset();if(jq.isOverlapped(i,[b.offsetWidth,b.offsetHeight],d,[f.offsetWidth,f.offsetHeight])){var k=this.parent.$n(),j;var h=zk(k).cmOffset(),e=k.offsetHeight,c=h[1]+e;j=i[1]+b.offsetHeight<=c?c:h[1]-f.offsetHeight;var g=zk(f).toStyleOffset(0,j);f.style.top=g[1]+"px";this._fixarrow()}},_fixarrow:function(){var i=this.parent.$n(),e=this.$n(),c=this.$n("p"),g=zk(i).revisedOffset(),d=zk(e).revisedOffset(),m=d[0]-g[0],k=d[1]-g[1],f,l=e.style;pw=2+(zk(c).borderWidth()/2)||0,ph=2+(zk(c).borderHeight()/2)||0;if(m>=i.offsetWidth-pw){f=k<ph-e.offsetHeight?"ld":k>=i.offsetHeight-ph?"lu":"l"}else{if(m<pw-e.offsetWidth){f=k<ph-e.offsetHeight?"rd":k>=i.offsetHeight-ph?"ru":"r"}else{f=k<0?"d":"u"}}e.style.padding="0";if(f=="d"||f=="u"){var h=(Math.max(m,0)+Math.min(e.offsetWidth+m,i.offsetWidth))/2-m-6,j=e.offsetWidth-11;c.style.left=(h>j?j:h<1?1:h)+"px";if(f=="d"){c.style.top=null;c.style.bottom="-4px";l.paddingBottom=ph+"px"}else{c.style.top="-4px";l.paddingTop=ph+"px"}}else{if(f=="l"||f=="r"){var h=(Math.max(k,0)+Math.min(e.offsetHeight+k,i.offsetHeight))/2-k-6,j=e.offsetHeight-11;c.style.top=(h>j?j:h<1?1:h)+"px";if(f=="r"){c.style.left=null;c.style.right="-4px";l.paddingRight=pw+"px"}else{c.style.left="-4px";l.paddingLeft=pw+"px"}}else{var b=c.style;b.left=b.top=b.right=b.bottom=null;switch(f){case"lu":b.left="0px";b.top="-4px";l.paddingTop=ph+"px";break;case"ld":b.left="0px";b.bottom="-4px";l.paddingBottom=ph+"px";break;case"ru":b.right="0px";b.top="-4px";l.paddingTop=ph+"px";break;case"rd":b.right="0px";b.bottom="-4px";l.paddingBottom=ph+"px";break}f=f=="ru"||f=="lu"?"u":"d"}}c.className=this.$s("pointer")+(a[f]?" "+this.$s(a[f]):"");jq(c).show()}},{_enddrag:function(c){var b=c.control;b.setTopmost();b._fixarrow()},_ignoredrag:function(c,d,b){return zul.inp.InputCtrl.isIgnoredDragForErrorbox(c,d,b)},_change:function(e){var d=e.control,b=d._stackup,c=d.$n();if(b){b.style.top=c.style.top;b.style.left=c.style.left}d._fixarrow();if(zk.mobile){zk(c).redoCSS()}}})})();