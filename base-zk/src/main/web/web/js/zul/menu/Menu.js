(function(){function e(g,f){if(g.isListen("onClick")){jq(g.$n())[f?"removeClass":"addClass"](g.$s("hover"))}}function c(j,g){if(j.isListen("onClick")){var i=jq(j.$n()).find("."+j.$s("separator")),h=zk(i),f=h.revisedOffset()[0];if(g.pageX>f){jq(j.$n()).addClass(j.$s("selected"));j.menupopup._shallClose=false;j._togglePopup();g.stop()}else{j.fireX(new zk.Event(j,"onClick",g.data))}}else{jq(j.$n()).addClass(j.isTopmost()?j.$s("selected"):j.$s("hover"));j.menupopup._shallClose=false;j._togglePopup()}}function d(f){return f.isVisible()&&f.$instanceof(zul.menu.Menu)}function b(h){for(var f=h;f;f=f.nextSibling){if(d(f)){return f}}var g=h.parent;if(g.firstChild==h){return h}return b(g.firstChild)}function a(h){for(var f=h;f;f=f.previousSibling){if(d(f)){return f}}var g=h.parent;if(g.lastChild==h){return h}return a(g.lastChild)}zul.menu.Menu=zk.$extends(zul.LabelImageWidget,{setContent:(function(f,g){return function(h,i){var j=this[f];this[f]=h;if(j!==h||(i&&i.force)){this.__fname__=f.substring(1);g.apply(this,arguments);delete this.__fname__}return this}})("_content",(function(g){if(!g||g.length==0){return}if(!this._contentHandler){if(zk.feature.pe){var f=this;zk.load("zkex.inp",null,function(){f._contentHandler=new zkex.inp.ContentHandler(f,g)});return}this._contentHandler=new zul.menu.ContentHandler(this,g)}else{this._contentHandler.setContent(g)}})),getContent:_zkf$=function(){return this._content},isContent:_zkf$,setImage:(function(f,g){return function(h,i){var j=this[f];this[f]=h;if(j!==h||(i&&i.force)){this.__fname__=f.substring(1);g.apply(this,arguments);delete this.__fname__}return this}})("_image",(function(f){if(f&&this._preloadImage){zUtl.loadImage(f)}this.rerender()})),getImage:_zkf$=function(){return this._image},isImage:_zkf$,open:function(){if(this.desktop&&this.isTopmost()){jq(this.$n()).addClass(this.$s("selected"));var f=this.getMenubar();if(f._lastTarget){this.$class._rmActive(f._lastTarget)}f._lastTarget=this;this.menupopup._shallClose=false;this._togglePopup()}},getAnchor_:function(){return this.$n("a")},domContent_:function(){var h='<span class="'+this.$s("text")+'">'+(zUtl.encodeXML(this.getLabel()))+"</span>",f=this.getImage(),i='<i class="'+this.$s("icon")+" z-icon-caret-"+(this.isTopmost()&&!this.isVertical_()?"down":"right")+'"></i>',j='<div class="'+this.$s("separator")+'"></div>',g=this.domIcon_();if(f){f='<img id="'+this.uuid+'-img" src="'+f+'" class="'+this.$s("image")+'" align="absmiddle" />'+(g?" "+g:"")}else{if(g){f=g}else{f='<img id="'+this.uuid+'-img" '+(this.isTopmost()?'style="display:none"':"")+' src="data:image/png;base64,R0lGODlhAQABAIAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="'+this.$s("image")+'" align="absmiddle" />'}}return f+" "+h+" "+j+i},isTopmost:function(){return this._topmost},beforeParentChanged_:function(f){this._topmost=f&&!(f.$instanceof(zul.menu.Menupopup));this.$supers("beforeParentChanged_",arguments)},onChildAdded_:function(f){this.$supers("onChildAdded_",arguments);if(f.$instanceof(zul.menu.Menupopup)){this.menupopup=f;if(this._contentHandler){this._contentHandler.destroy()}}},onChildRemoved_:function(f){this.$supers("onChildRemoved_",arguments);if(f==this.menupopup){this.menupopup=null;if(this._contentHandler){this._contentHandler.setContent(this._content)}}},getMenubar:function(){for(var f=this.parent;f;f=f.parent){if(f.$instanceof(zul.menu.Menubar)){return f}if(!f.$instanceof(zul.menu.Menupopup,zul.menu.Menu)){break}}return null},onShow:function(){if(this._contentHandler){this._contentHandler.onShow()}},onFloatUp:function(f){if(this._contentHandler){this._contentHandler.onFloatUp(f)}},onHide:function(){if(this._contentHandler){this._contentHandler.onHide()}},focus_:function(g,f){if(this.isTopmost()&&zk(this.getAnchor_()).focus(g)){if(f){this._ignoreActive=true}return true}return this.$supers("focus_",arguments)},_getPrevVisibleMenu:function(){var f=this.previousSibling;if(!f){var g=this.getMenubar();if(g){f=g.lastChild}}return f?a(f):this},_getNextVisibleMenu:function(){var f=this.nextSibling;if(!f){var g=this.getMenubar();if(g){f=g.firstChild}}return f?b(f):this},doKeyDown_:function(g){if(this.isTopmost()){var i=g.keyCode;if(this.isVertical_()){switch(i){case 38:i=37;break;case 40:i=39;break;case 37:i=38;break;case 39:i=40;break}}switch(i){case 38:var f=this.menupopup;if(f&&f.isOpen()){jq(this.$n()).removeClass(this.$s("hover")).removeClass(this.$s("selected"));f.close()}this.$class._addActive(this);g.stop();break;case 40:if(this.menupopup){jq(this.$n()).addClass(this.$s("selected")).removeClass(this.$s("hover"));this.menupopup._shallClose=false;this.menupopup.open()}g.stop();break;case 37:case 39:var h=i==37?this._getPrevVisibleMenu():this._getNextVisibleMenu();if(h){h.focus()}g.stop();break;case 13:if(this.menupopup){c(this,g)}g.stop();break;case 9:this.$class._rmActive(this);break}}this.$supers("doKeyDown_",arguments)},doFocus_:function(){if(this.isTopmost()){var g=this.getMenubar(),f=this.$class;if(g&&g._lastTarget){f._rmActive(g._lastTarget)}if(!this._ignoreActive){f._addActive(this)}}delete this._ignoreActive;this.$supers("doFocus_",arguments)},bind_:function(){this.$supers(zul.menu.Menu,"bind_",arguments);var f=this.getAnchor_();this.domListen_(f,"onFocus","doFocus_").domListen_(f,"onBlur","doBlur_").domListen_(f,"onMouseEnter").domListen_(f,"onMouseLeave");if(this.isTopmost()&&this.isListen("onClick")){jq(this.$n()).addClass(this.$s("clickable"))}if(this._contentHandler){this._contentHandler.bind()}},unbind_:function(){var f=this.getAnchor_();this.domUnlisten_(f,"onFocus","doFocus_").domUnlisten_(f,"onBlur","doBlur_").domUnlisten_(f,"onMouseEnter").domUnlisten_(f,"onMouseLeave");if(this._contentHandler){this._contentHandler.unbind()}this.$supers(zul.menu.Menu,"unbind_",arguments)},_getArrowWidth:function(){return 20},_showContentHandler:function(){var f=this._contentHandler;if(f&&!f.isOpen()){f.onShow()}},doClick_:function(f){if(this.menupopup){if(this.isTopmost()){this.getMenubar()._lastTarget=this}c(this,f)}else{this._showContentHandler()}},doMouseOver_:function(){if(!this.isTopmost()){this._showContentHandler()}this.$supers("doMouseOver_",arguments)},_togglePopup:function(){if(!this.menupopup&&this._contentHandler){this._showContentHandler()}else{if(!this.menupopup.isOpen()){if(this.isTopmost()){e(this)}this.menupopup.open()}else{if(this.isTopmost()){this.menupopup.close({sendOnOpen:true})}else{zk(this.menupopup.$n("a")).focus()}}}},_doMouseEnter:function(f){var h=this.getMenubar();if(h){h._noFloatUp=false}var g=this.isTopmost();if(g){e(this)}if(g&&zk.ie<11&&!jq.isAncestor(this.getAnchor_(),f.domTarget)){return}if(this.menupopup){this.menupopup._shallClose=false}if(!g){zWatch.fire("onFloatUp",this);if(this.menupopup&&!this.menupopup.isOpen()){this.menupopup.open()}}else{if(this.menupopup&&h._autodrop){zWatch.fire("onFloatUp",this);if(!this.menupopup.isOpen()){this.menupopup.open()}}else{var i=h._lastTarget;if(i&&i!=this&&i.menupopup&&i.menupopup.isVisible()){i.menupopup.close({sendOnOpen:true});this.$class._rmActive(i);if(this.menupopup){this.menupopup.open()}}}}this.$class._addActive(this)},_doMouseLeave:function(f){var h=this.getMenubar();this._updateHoverImage();var g=this.isTopmost(),i=this.menupopup;if(g){this.$class._rmActive(this,true);if(i&&h._autodrop){if(i.isOpen()){i._shallClose=true}}}else{if(!i||!i.isOpen()){this.$class._rmActive(this)}}},getImageNode:function(){if(!this._eimg&&(this._image||this._hoverImage)){var f=this.$n();if(f){this._eimg=this.$n("a").firstChild}}return this._eimg},ignoreDescendantFloatUp_:function(f){return f&&f.$instanceof(zul.menu.Menupopup)},isVertical_:function(){if(this.isTopmost()){var f=this.getMenubar();if(f){return"vertical"==f.getOrient()}}return false}},{_isActive:function(i){var h=i.isTopmost(),j=i.$n(),g=i.menupopup,f=h?g&&g.isOpen()?i.$s("selected"):i.$s("hover"):i.$s("hover");return jq(j).hasClass(f)},_addActive:function(j){var h=j.isTopmost(),k=j.$n(),g=j.menupopup,f=h?g&&g.isOpen()?j.$s("selected"):j.$s("hover"):j.$s("hover");jq(k).addClass(f);if(h){var i=j.getMenubar();if(i){i._lastTarget=j}}if(!h&&j.parent.parent.$instanceof(zul.menu.Menu)){this._addActive(j.parent.parent)}},_rmActive:function(k,g){var j=k.isTopmost(),l=k.$n(),i=k.menupopup,f=j?(!g&&i&&i.isOpen())?k.$s("selected"):k.$s("hover"):k.$s("hover");var h=jq(l).removeClass(f);if(j&&!(h.hasClass(k.$s("selected"))||h.hasClass(k.$s("hover")))){e(k,true)}}});zul.menu.ContentHandler=zk.$extends(zk.Object,{$init:function(g,f){this._wgt=g;this._content=f},setContent:function(f){if(this._content!=f||!this._pp){this._content=f;this._wgt.rerender()}},redraw:function(f){var h=this._wgt,g=h.getZclass();f.push('<div id="',h.uuid,'-cnt-pp" class="',h.$s("content-popup"),'" style=""><div class="',h.$s("content-body"),'">',this._content,"</div></div>")},bind:function(){var f=this._wgt;if(!f.menupopup){f.domListen_(f.$n(),"onClick","onShow");zWatch.listen({onFloatUp:f,onHide:f})}this._pp=f.$n("cnt-pp");jq(this._pp,zk).bind("mouseenter",this.proxy(this._doMouseEnter)).bind("mouseleave",this.proxy(this._doMouseLeave))},unbind:function(){var f=this._wgt;if(!f.menupopup){if(this._shadow){this._shadow.destroy();this._shadow=null}f.domUnlisten_(f.$n(),"onClick","onShow");zWatch.unlisten({onFloatUp:f,onHide:f})}jq(this._pp,zk).unbind("mouseenter",this.proxy(this._doMouseEnter)).unbind("mouseleave",this.proxy(this._doMouseLeave));this._pp=null},isOpen:function(){var f=this._pp;return(f&&zk(f).isVisible())},_doMouseEnter:function(){var f=this._wgt.getMenubar();if(f){f._bOver=true}},_doMouseLeave:function(){var f=this._wgt.getMenubar();if(f){f._bOver=false}},onShow:function(){var g=this._wgt,f=this._pp;if(!f){return}f.style.display="block";jq(f).zk.makeVParent();zWatch.fireDown("onVParent",this);zk(f).position(g.$n(),this.getPosition());this.syncShadow()},onHide:function(){var f=this._pp;if(!f||!zk(f).isVisible()){return}f.style.display="none";jq(f).zk.undoVParent();zWatch.fireDown("onVParent",this);this.hideShadow()},onFloatUp:function(f){if(!zUtl.isAncestor(this._wgt,f.origin)){this.onHide()}},syncShadow:function(){if(!this._shadow){this._shadow=new zk.eff.Shadow(this._wgt.$n("cnt-pp"),{stackup:zk.useStackup})}this._shadow.sync()},hideShadow:function(){if(this._shadow){this._shadow.hide()}},destroy:function(){this._wgt.rerender()},getPosition:function(){var f=this._wgt;return f.isVertical_()?"end_before":"after_start"},deferRedrawHTML_:function(f){f.push("<li",this.domAttrs_({domClass:1}),' class="z-renderdefer"></li>')}})})();