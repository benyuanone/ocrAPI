(function(){var b,k,m,c;function h(o){if(m&&!m.isOpen()){l();g();m=c=null}var n=m&&zUtl.isAncestor(m,o);if(n){g()}return !n}function e(p,o,q,n){if(m!=p||c!=o){f();b={tip:p,ref:o,params:q,timer:setTimeout(function(){a(n)},q.delay!==undefined?q.delay:zk.tipDelay)}}else{g()}}function d(n){if(c==n||m==n){g();k=setTimeout(f,100)}else{l()}}function l(){var n=b;if(n){b=null;clearTimeout(n.timer)}}function g(){var n=k;if(n){k=null;clearTimeout(n)}}function a(q){var p=b;if(p){m=p.tip,c=p.ref;b=null;var u=c.$n();if(!u||!zk(u).isRealVisible()){return m=c=null}var s=p.params,o=s.x,t=s.y;if(o){s.x=i(q,o)}if(t){s.y=i(q,t)}var r=s.x!==undefined?[s.x,s.y]:zk.currentPointer;m.open(c,r,s.position?s.position:s.x===null?"after_pointer":null,{sendOnOpen:true})}}function f(){l();g();var o=m;if(o&&o.desktop){if(zk.ie==10||zk.ff){var q=jq(o.$n()),n=q.offset(),p=zk.currentPointer;if((p[0]>=n.left&&p[0]<=(n.left+q.width()))&&(p[1]>=n.top&&p[1]<=(n.top+q.height()))){return}}m=c=null;o.close({sendOnOpen:true})}}function j(n){zk.error("setCtrlKeys: "+n)}function i(p,n){if(n.indexOf("(")!=-1&&n.indexOf(")")!=-1){var o=new Function("event","return "+n+";");return o(p)}else{return zk.parseInt(n)}}zul.Widget=zk.$extends(zk.Widget,{getContext:function(){return this._context},setContext:function(n){if(zk.Widget.isInstance(n)){n="uuid("+n.uuid+")"}this._context=n;return this},getPopup:function(){return this._popup},setPopup:function(n){if(zk.Widget.isInstance(n)){n="uuid("+n.uuid+")"}this._popup=n;return this},getTooltip:function(){return this._tooltip},setTooltip:function(n){if(zk.Widget.isInstance(n)){n="uuid("+n.uuid+")"}this._tooltip=n;return this},getCtrlKeys:function(){return this._ctrlKeys},setCtrlKeys:function(x){if(this._ctrlKeys==x){return}if(!x){this._ctrlKeys=this._parsedCtlKeys=null;return}var u=[{},{},{},{},{}],p=0;for(var r=0,t=x.length;r<t;++r){var n=x.charAt(r);switch(n){case"^":case"$":case"@":if(p){return j("Combination of Shift, Alt and Ctrl not supported: "+x)}p=n=="^"?1:n=="@"?2:3;break;case"#":var o=r+1;for(;o<t;++o){var q=x.charAt(o);if((q>"Z"||q<"A")&&(q>"z"||q<"a")&&(q>"9"||q<"0")){break}}if(o==r+1){return j("Unexpected character "+n+" in "+x)}var y=x.substring(r+1,o).toLowerCase();if("pgup"==y){n=33}else{if("pgdn"==y){n=34}else{if("end"==y){n=35}else{if("home"==y){n=36}else{if("left"==y){n=37}else{if("up"==y){n=38}else{if("right"==y){n=39}else{if("down"==y){n=40}else{if("ins"==y){n=45}else{if("del"==y){n=46}else{if("bak"==y){n=8}else{if(y.length>1&&y.charAt(0)=="f"){var w=zk.parseInt(y.substring(1));if(w==0||w>12){return j("Unsupported function key: #f"+w)}n=112+w-1}else{return j("Unknown #"+y+" in "+x)}}}}}}}}}}}}u[p][n]=true;p=0;r=o-1;break;default:if(!p||((n>"Z"||n<"A")&&(n>"z"||n<"a")&&(n>"9"||n<"0"))){return j("Unexpected character "+n+" in "+x)}if(p==3){return j("$a - $z not supported (found in "+x+"). Allowed: $#f1, $#home and so on.")}if(n<="z"&&n>="a"){n=n.toUpperCase()}u[p][n.charCodeAt(0)]=true;p=0;break}}this._parsedCtlKeys=u;this._ctrlKeys=x;return this},_parsePopParams:function(q,n){var p={},s=q.indexOf(","),o=q.indexOf("="),w=q;if(o!=-1){w=q.substring(0,q.substring(0,o).lastIndexOf(","))}if(s!=-1){p.id=w.substring(0,s).trim();var r=w.substring(s+1,w.length);if(r){p.position=r.trim()}zk.copy(p,zUtl.parseMap(q.substring(w.length,q.length)))}else{p.id=q.trim()}if(this._popup||this._context){var v=p.x,u=p.y;if(v){p.x=i(n,v)}if(u){p.y=i(n,u)}}if(p.delay){p.delay=zk.parseInt(p.delay)}return p},doClick_:function(o,q){if(!this.shallIgnoreClick_(o)&&!o.contextSelected){var s=this._popup?this._parsePopParams(this._popup,o):{},n=this._smartFellow(s.id);if(n){o.contextSelected=true;var p=this,r=s.x!==undefined?[s.x,s.y]:[o.pageX,o.pageY];if(s.type&&s.type=="toggle"&&n.isOpen()){n.close({sendOnOpen:true})}else{setTimeout(function(){n.open(p,r,s.position?s.position:null,{sendOnOpen:true,type:s.type,which:1})},0)}o.stop({dom:true})}}if(q!==true){this.$supers("doClick_",arguments)}},doRightClick_:function(o){if(!this.shallIgnoreClick_(o)&&!o.contextSelected){var r=this._context?this._parsePopParams(this._context,o):{},n=this._smartFellow(r.id);if(n){o.contextSelected=true;var p=this,q=r.x!==undefined?[r.x,r.y]:[o.pageX,o.pageY];if(r.type&&r.type=="toggle"&&n.isOpen()){n.close({sendOnOpen:true})}else{setTimeout(function(){n.open(p,q,r.position?r.position:null,{sendOnOpen:true,type:r.type,which:3})},0)}o.stop({dom:true})}}this.$supers("doRightClick_",arguments)},doTooltipOver_:function(n){if(!n.tooltipped&&h(this)){var p=this._tooltip?this._parsePopParams(this._tooltip):{},o=this._smartFellow(p.id);if(o){n.tooltipped=true;e(o,this,p,n)}}this.$supers("doTooltipOver_",arguments)},doTooltipOut_:function(n){d(this);this.$supers("doTooltipOut_",arguments)},_smartFellow:function(n){return n?n.startsWith("uuid(")&&n.endsWith(")")?zk.Widget.$(n.substring(5,n.length-1)):this.$f(n,true):null},doKeyDown_:function(n){if(this.getCtrlKeys()||this.isListen("onOK")||this.isListen("onCancel")){if(!this.afterKeyDown_(n)){this.$supers("doKeyDown_",arguments)}}else{this.$supers("doKeyDown_",arguments)}},afterKeyDown_:function(o){var t=o.keyCode,s="onCtrlKey",q;switch(t){case 13:var r=o.domTarget,n=jq.nodeName(r);if(n=="textarea"||(n=="button"&&(!r.id||!r.id.endsWith("-a")))||(n=="input"&&r.type.toLowerCase()=="button")){return}q=s="onOK";break;case 27:q=s="onCancel";break;case 16:case 17:case 18:return;case 45:case 46:case 8:break;default:if((t>=33&&t<=40)||(t>=112&&t<=123)||o.ctrlKey||o.altKey){break}return}var r=o.target,u=r;for(;;u=u.parent){if(!u){return}if(!u.isListen(s,{any:true})){continue}if(q){break}var p=u._parsedCtlKeys;if(p&&p[o.ctrlKey?1:o.altKey?2:o.shiftKey?3:0][t]){break}}setTimeout(function(){for(var v=r;;v=v.parent){if(v.beforeCtrlKeys_&&v.beforeCtrlKeys_(o)){return}if(v==u){break}}u.fire(s,zk.copy({reference:r},o.data))},0);o.stop();if(jq.nodeName(o.domTarget,"select")){o.stop({dom:true,revoke:true})}if(zk.ie<11&&t==112){zk._oldOnHelp=window.onhelp;window.onhelp=function(){return false};setTimeout(function(){window.onhelp=zk._oldOnHelp;zk._oldOnHelp=null},200)}return true},beforeCtrlKeys_:function(n){}},{getOpenTooltip:function(){return m&&m.isOpen()?m:null}})})();