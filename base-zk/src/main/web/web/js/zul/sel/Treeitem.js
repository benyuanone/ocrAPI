(function(){function e(g){for(;g&&!g.$instanceof(zul.sel.Tree);g=g.parent){if(g.isOpen&&!g.isOpen()){return true}}}function d(h,i){if(i.isSelected()){h.$remove(i)}var g;if(g=i.treechildren){for(g=g.firstChild;g&&h.length;g=g.nextSibling){d(h,g)}}}function b(h,i){if(i.isSelected()){h.push(i)}var g;if(g=i.treechildren){for(g=g.firstChild;g;g=g.nextSibling){b(h,g)}}}function f(j,i){var k=j.$n();if(k){k.style.display=i?"":"none"}var h;if(h=j.treechildren){for(var g=h.firstChild;g;g=g.nextSibling){if(g._visible&&g._open){f(g,i)}}}}function c(h){var g;if(h){if(h.treerow){return h}if(h.isContainer()){for(var i=h.treechildren.lastChild;i;i=i.previousSibling){g=c(i);if(g){return g}}}g=c(h.previousSibling)}return g}function a(h){var g;if(h){if(h.treerow){return h}if(h.isContainer()){for(var i=h.treechildren.firstChild;i;i=i.nextSibling){g=a(i);if(g){return g}}}g=a(h.nextSibling)}return g}zul.sel.Treeitem=zk.$extends(zul.sel.ItemWidget,{_open:true,setOpen:(function(g,h){return function(i,j){var k=this[g];this[g]=i;if(k!==i||(j&&j.force)){this.__fname__=g.substring(1);h.apply(this,arguments);delete this.__fname__}return this}})("_open",(function(l,k){var j=this.$n("open"),m=this.$n("icon");if(!j||e(this.parent)){if(m){var n=m.className;m.className=l?n.replace("-right","-down").replace("-close","-open"):n.replace("-down","-right").replace("-open","-close")}return}if(m){var n=m.className;m.className=l?n.replace("-right","-down").replace("-close","-open"):n.replace("-down","-right").replace("-open","-close")}var h=this.getTree(),g=h?h.ebodytbl:null,i=g?g.clientWidth:0;if(!l){zWatch.fireDown("onHide",this)}this._showKids(l);if(l){zUtl.fireShown(this)}if(h){h._sizeOnOpen();if(!k){this.fire("onOpen",{open:l},{toServer:h.inPagingMold()||h.isModel()})}h._syncFocus(this);h.focus();if(g){h._fixhdwcnt=h._fixhdwcnt||0;if(!h._fixhdwcnt++){h._fixhdoldwd=i}setTimeout(function(){if(!--h._fixhdwcnt&&h.$n()&&(h._fixhdoldwd!=g.clientWidth)){h._calcSize()}},250)}}})),getOpen:_zkf$=function(){return this._open},isOpen:_zkf$,_showKids:function(i){var g=this.treechildren;if(g){for(var h=g.firstChild,j=g._isRealVisible();h;h=h.nextSibling){h.$n().style.display=j&&h.isVisible()&&i?"":"none";if(h.isOpen()){h._showKids(i)}}}},isStripeable_:function(){return false},getMeshWidget:_zkf=function(){return this.parent?this.parent.getTree():null},getTree:_zkf,getZclass:function(){if(this.treerow){return this.treerow.getZclass()}return null},$n:function(g){if(this.treerow){return g?this.treerow.$n(g):this.treerow.$n()||jq(this.treerow.uuid,zk)[0]}return null},isContainer:function(){return this.treechildren!=null},isEmpty:function(){return !this.treechildren||!this.treechildren.nChildren},getLevel:function(){var h=0;for(var g=this;;++h){if(!g.parent){break}g=g.parent.parent;if(!g||g.$instanceof(zul.sel.Tree)){break}}return h},getLabel:function(){var g=this.getFirstCell();return g?g.getLabel():null},setLabel:function(g){this._autoFirstCell().setLabel(g)},getFirstCell:function(){return this.treerow?this.treerow.firstChild:null},_autoFirstCell:function(){if(!this.treerow){this.appendChild(new zul.sel.Treerow())}var g=this.treerow.firstChild;if(!g){g=new zul.sel.Treecell();this.treerow.appendChild(g)}return g},getImage:function(){var g=this.getFirstCell();return g?g.getImage():null},setImage:function(g){this._autoFirstCell().setImage(g);return this},getParentItem:function(){var g=this.parent&&this.parent.parent?this.parent.parent:null;return g&&g.$instanceof(zul.sel.Treeitem)?g:null},_isRealVisible:function(){var g;return this.isVisible()&&(g=this.parent)&&g._isRealVisible()},_isVisibleInTree:function(){if(!this.isVisible()){return}var h=this.parent,g;if(!h||!h.isVisible()||!(g=h.parent)){return false}if(g.$instanceof(zul.sel.Tree)){return true}return g._isVisibleInTree()},setVisible:function(g){if(this.isVisible()!=g){this.$supers("setVisible",arguments);if(this.treerow){this.treerow.setVisible(g)}f(this,this._isRealVisible())}return this},beforeParentChanged_:function(i){var h=this.getTree();if(h){h._onTreeitemRemoved(this)}if(i){var g=i.getTree();if(g){g._onTreeitemAdded(this)}}this.$supers("beforeParentChanged_",arguments)},isRealElement:function(){return false},insertBefore:function(i,h,g){if(this.$super("insertBefore",i,h,g||(!this.z_rod&&i.$instanceof(zul.sel.Treechildren)))){this._fixOnAdd(i,g);return true}},appendChild:function(h,g){if(this.$super("appendChild",h,g||(!this.z_rod&&h.$instanceof(zul.sel.Treechildren)))){if(!this.insertingBefore_){this._fixOnAdd(h,g)}return true}},_fixOnAdd:function(h,g){if(h.$instanceof(zul.sel.Treerow)){this.treerow=h}else{if(h.$instanceof(zul.sel.Treechildren)){this.treechildren=h;if(!g&&this.treerow){this.rerender()}}}},onChildRemoved_:function(g){this.$supers("onChildRemoved_",arguments);if(g==this.treerow){this.treerow=null}else{if(g==this.treechildren){this.treechildren=null;if(!this.childReplacing_){this._syncIcon(true)}}}},onChildAdded_:function(g){this.$supers("onChildAdded_",arguments);if(this.childReplacing_){this._fixOnAdd(g,true)}else{if(this.desktop){this._fixOnAdd(g,true)}}},removeHTML_:function(i){for(var h,g=this.firstChild;g;g=g.nextSibling){h=g.$n();if(h){g.removeHTML_(h)}}this.$supers("removeHTML_",arguments)},replaceWidget:function(g){zul.sel.Treeitem._syncSelItems(this,g);if(this.treechildren){this.treechildren.detach()}this.$supers("replaceWidget",arguments)},_removeChildHTML:function(i){for(var h,g=this.firstChild;g;g=g.nextSibling){if(g!=this.treerow&&(h=g.$n())){g.removeHTML_(h)}}},_renderChildHTML:function(o){var p,k,q=this.getTree();if(p=this.previousSibling){if(q&&q.getMold()=="paging"){var l=q.getPageSize();for(;p&&l-->0;p=p.previousSibling){if(p.treerow){k=p;break}}}else{k=c(p)}if(k){var i=k.$n();if(k.isContainer()){var g=k.treechildren.lastChild;for(;g;g=g.previousSibling){var h=g.$n();if(h){i=h;break}}}jq(i).after(o);return}}if(p=this.nextSibling){if(q&&q.getMold()=="paging"){var l=q.getPageSize();for(;p&&l-->0;p=p.nextSibling){if(p.treerow){k=p;break}}}else{k=a(p)}if(k){var i=k.$n();if(this.isContainer()){var m=this.treechildren.firstChild;for(;m;m=m.nextSibling){var h=m.$n();if(h){i=h;break}}}jq(i).before(o);return}}if(p=this.getParentItem()){var h=p.$n();if(h){jq(h).after(o)}else{p._renderChildHTML(o)}}else{if((p=this.getTree())){var j=p.$n("rows");if(this.isContainer()){var m=this.treechildren.firstChild;if(m){var i=m.$n();if(i){jq(i).before(o);return}else{if(j.firstChild){jq(j.firstChild).before(o);return}}}}jq(j).append(o)}}},insertChildHTML_:function(i,g,h){if(g=g?g.getFirstNode_():null){jq(g).before(i.redrawHTML_())}else{this._renderChildHTML(i.redrawHTML_())}i.bind(h)},getOldWidget_:function(h){var g=this.$supers("getOldWidget_",arguments);if(g&&g.$instanceof(zul.sel.Treerow)){return g.parent}return g},replaceHTML:function(i,h,g){this._removeChildHTML(i);this.$supers("replaceHTML",arguments)},_syncIcon:function(g){if(this.desktop&&this.treerow){var h=this.treerow;if(h=h.firstChild){h._syncIcon(g)}if(h=this.treechildren){for(h=h.firstChild;h;h=h.nextSibling){h._syncIcon(g)}}}}},{_syncSelItems:function(i,j){var g;if((g=i.getTree())&&(g=g._selItems)){if(i.$instanceof(zul.sel.Treechildren)){for(var h=i.firstChild;h;h=h.nextSibling){d(g,h)}for(var h=j.firstChild;h;h=h.nextSibling){b(g,h)}}else{d(g,i);b(g,j)}}}})})();