zul.sel.Listheader=zk.$extends(zul.mesh.SortWidget,{getListbox:_zkf=function(){return this.parent?this.parent.parent:null},$init:function(){this.$supers("$init",arguments);this.listen({onGroup:this},-1000)},getMeshBody:_zkf,checkClientSort_:function(b){var a;return !(!(a=this.getMeshBody())||a.hasGroup())&&this.$supers("checkClientSort_",arguments)},setMaxlength:(function(a,b,c){return function(d,e){var f=this[a];this.__fname__=a.substring(1);this[a]=d=b.apply(this,arguments);if(f!==d||(e&&e.force)){c.apply(this,arguments)}delete this.__fname__;return this}})("_maxlength",(function(a){return !a||a<0?0:a}),(function(){if(this.desktop){this.rerender();this.updateCells_()}})),getMaxlength:_zkf$=function(){return this._maxlength},isMaxlength:_zkf$,group:function(e,s){var v=this.getSortDirection();if(e){if("ascending"==v){return false}}else{if("descending"==v){return false}}var y=e?this._sortAscending:this._sortDescending;if(y=="fromServer"){return false}else{if(y=="none"){s.stop();return false}}var a=this.getMeshWidget();if(!a||a.isModel()||!zk.feature.pe||!zk.isLoaded("zkex.sel")){return false}var q=this.getMeshBody();if(!q){return false}s.stop();var E=q.desktop,x=q.$n();try{q.unbind();if(q.hasGroup()){for(var u=q.getGroups(),C=u.length;--C>=0;){q.removeChild(u[C])}}var F=[],f=this.getChildIndex();for(var B=0,o=0,g=a.getBodyWidgetIterator(),p;(p=g.next());o++){for(var A=0,b=p.firstChild;b;b=b.nextSibling,A++){if(A==f){F[B++]={wgt:b,index:o}}}}var l=v=="ascending"?-1:1,n=this.sorting,r=y=="client(number)";F.sort(function(i,d){var k=n(i.wgt,d.wgt,r)*l;if(k==0){k=(i.index<d.index?-1:1)}return k});for(var D=q.firstItem;D;D=q.nextItem(D)){q.removeChild(D)}for(var c,j,h=this.getChildIndex(),B=0,A=F.length;B<A;B++){j=F[B];if(!c||n(c.wgt,j.wgt,r)!=0){var m,b=j.wgt.parent.getChildAt(h);if(b){if(b.getLabel()){m=new zkex.sel.Listgroup({label:b.getLabel()})}else{var t=b.firstChild;if(t&&t.$instanceof(zul.wgt.Label)){m=new zkex.sel.Listgroup({label:t.getValue()})}else{m=new zkex.sel.Listgroup({label:msgzul.GRID_OTHER})}}}q.appendChild(m)}q.appendChild(j.wgt.parent);c=j}this._fixDirection(e)}finally{q.replaceHTML(x,E)}return true},onGroup:function(a){var b=this.getSortDirection();if("ascending"==b){this.group(false,a)}else{if("descending"==b){this.group(true,a)}else{if(!this.group(true,a)){this.group(false,a)}}}},updateCells_:function(){var d=this.getListbox();if(d==null||d.getMold()=="select"){return}var b=this.getChildIndex(),a;for(var c=d.getBodyWidgetIterator();(a=c.next());){if(b<a.nChildren){a.getChildAt(b).rerender()}}a=d.listfoot;if(a&&b<a.nChildren){a.getChildAt(b).rerender()}},bind_:function(){this.$supers(zul.sel.Listheader,"bind_",arguments);var a=this.$n("cm"),d=this.$n();if(a){var c=this.getListbox();if(c){c._headercm=a}this.domListen_(a,"onClick","_doClick")}if(d){this.domListen_(d,"onMouseOver","_doMouseOver").domListen_(d,"onMouseOut","_doMouseOut")}var b=this.$n("btn");if(b){this.domListen_(b,"onClick","_doMenuClick")}},unbind_:function(){var a=this.$n("cm"),d=this.$n();if(a){var c=this.getListbox();if(c){c._headercm=null}this._checked=null;this.domUnlisten_(a,"onClick","_doClick")}if(d){this.domUnlisten_(d,"onMouseOver","_doMouseOver").domUnlisten_(d,"onMouseOut","_doMouseOut")}var b=this.$n("btn");if(b){this.domUnlisten_(b,"onClick","_doMenuClick")}this.$supers(zul.sel.Listheader,"unbind_",arguments)},_doMouseOver:function(a){if(this.isSortable_()||(this.parent._menupopup&&this.parent._menupopup!="none")){jq(this.$n()).addClass(this.$s("hover"))}},_doMouseOut:function(a){if(this.isSortable_()||(this.parent._menupopup&&this.parent._menupopup!="none")){var b=jq(this.$n());if(!b.hasClass(this.$s("visited"))){b.removeClass(this.$s("hover"))}}},_doClick:function(b){this._checked=!this._checked;var d=this.getListbox(),a=this.$n("cm"),c=jq(a);if(this._checked){c.addClass(this.$s("checked"));d.selectAll(true,b)}else{c.removeClass(this.$s("checked"));d._select(null,b)}d.fire("onCheckSelectAll",this._checked)},doClick_:function(b){var c=this.getListbox(),a=this.$n("cm");if(c&&c._checkmark){var d=b.domTarget;if(d==a||d.parentNode==a){return}}this.$supers("doClick_",arguments)},domContent_:function(){var a=this.$supers("domContent_",arguments),b=this.getListbox();if(b!=null&&this.parent.firstChild==this&&b._checkmark&&b._multiple&&!b._listbox$noSelectAll){a='<span id="'+this.uuid+'-cm" class="'+this.$s("checkable")+'"><i class="'+this.$s("icon")+' z-icon-check"></i></span>'+(a?"&nbsp;"+a:"")}return a},domLabel_:function(){return zUtl.encodeXML(this.getLabel(),{maxlength:this._maxlength})}});