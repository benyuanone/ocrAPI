(function(){function b(e){return zk.isLoaded("zkex.sel")&&e.$instanceof(zkex.sel.Listgroup)}function a(e){if(e._nativebar&&(e=e.frozen)){e._syncFrozen()}}function d(g){if(g.desktop){var f=g.$n("empty"),h=0;if(g._nrows){f.style.display="none"}else{if(g.listhead){for(var e=g.listhead.firstChild;e;e=e.nextSibling){if(e.isVisible()){h++}}}f.colSpan=h||1;f.style.display="table-cell"}}g._shallFixEmpty=false}var c=zul.sel.Listbox=zk.$extends(zul.sel.SelectWidget,{_nrows:0,groupSelect:false,_scrollbar:null,setEmptyMessage:(function(e,f){return function(g,h){var i=this[e];this[e]=g;if(i!==g||(h&&h.force)){this.__fname__=e.substring(1);f.apply(this,arguments);delete this.__fname__}return this}})("_emptyMessage",(function(e){if(this.desktop){jq(this.$n("empty")).html(e)}})),getEmptyMessage:_zkf$=function(){return this._emptyMessage},isEmptyMessage:_zkf$,$init:function(){this.$supers(c,"$init",arguments);this._groupsInfo=[]},getGroupCount:function(){return this._groupsInfo.length},getGroups:function(){return this._groupsInfo.$clone()},hasGroup:function(){return this._groupsInfo.length},nextItem:function(e){if(e){while((e=e.nextSibling)&&!e.$instanceof(zul.sel.Listitem)){}}return e},previousItem:function(e){if(e){while((e=e.previousSibling)&&!e.$instanceof(zul.sel.Listitem)){}}return e},getOddRowSclass:function(){return this._scOddRow==null?this.$s("odd"):this._scOddRow},setOddRowSclass:function(e){if(!e){e=null}if(this._scOddRow!=e){this._scOddRow=e;var f=this.$n();if(f&&this.rows){this.stripe()}}return this},inSelectMold:function(){return"select"==this.getMold()},onSize:function(){this.$supers(c,"onSize",arguments);var e=this,f=this.desktop&&!this.inSelectMold()&&!this._nativebar;if(!this._scrollbar&&f){this._scrollbar=zul.mesh.Scrollbar.init(this)}setTimeout(function(){if(e.desktop){if(f){e.refreshBar_()}e._syncSelInView()}},300)},destroyBar_:function(){var e=this._scrollbar;if(e){e.destroy();e=this._scrollbar=null}},bind_:function(h,g,f){this.$supers(c,"bind_",arguments);this._shallStripe=true;var e=this;f.push(function(){e.stripe();a(e);d(e)});this._shallScrollIntoView=true},unbind_:function(){this.destroyBar_();this.$supers(c,"unbind_",arguments)},_syncSelInView:function(){if(this._shallScrollIntoView){var f=this.getSelectedIndex();if(f>=0){var e,h=this._scrollbar;if(h){for(var g=this.getBodyWidgetIterator();f-->=0;){e=g.next()}if(e){h.scrollToElement(e.$n())}}else{var e;for(var g=this.getBodyWidgetIterator();f-->=0;){e=g.next()}if(e){zk(e).scrollIntoView(this.ebody);this._tmpScrollTop=this.ebody.scrollTop}}}this._shallScrollIntoView=false}},_doScroll:function(){if(this._tmpScrollTop){this.ebody.scrollTop=this._tmpScrollTop;this._tmpScrollTop=null}this.$super(zul.sel.Listbox,"_doScroll")},onResponse:function(e,f){if(this.desktop){if(this._shallStripe){this.stripe()}if(this._shallFixEmpty){d(this)}}this.$supers(c,"onResponse",arguments)},_syncStripe:function(){this._shallStripe=true},stripe:function(){var e=this.getOddRowSclass();if(!e){return}var i=this._offset&1,k=!i,h=this.getBodyWidgetIterator();for(var g=0,f;f=h.next();g++){if(f.isVisible()&&f.isStripeable_()){jq(f)[k?"removeClass":"addClass"](e);k=!k}}this._shallStripe=false;return this},rerender:function(){this.$supers(c,"rerender",arguments);this._syncStripe();return this},getCaveNode:function(){return this.$n("rows")||this.$n("cave")},insertChildHTML_:function(g,e,f){if(e=e&&(!g.$instanceof(zul.sel.Listitem)||e.$instanceof(zul.sel.Listitem))?e.getFirstNode_():null){jq(e).before(g.redrawHTML_())}else{jq(this.getCaveNode()).append(g.redrawHTML_())}g.bind(f)},insertBefore:function(g,f,e){if(this.$super("insertBefore",g,f,e||(!this.z_rod&&!g.$instanceof(zul.sel.Listitem)))){this._fixOnAdd(g,e);return true}},appendChild:function(f,e){if(this.$super("appendChild",f,e||(!this.z_rod&&!f.$instanceof(zul.sel.Listitem)))){if(!this.insertingBefore_){this._fixOnAdd(f,e)}return true}},_fixOnAdd:function(i,f,g,e){var h;if(i.$instanceof(zul.sel.Listitem)){if(b(i)){this._groupsInfo.push(i)}if(!this.firstItem||!this.previousItem(i)){this.firstItem=i}if(!this.lastItem||!this.nextItem(i)){this.lastItem=i}++this._nrows;if(i.isSelected()&&!this._selItems.$contains(i)){this._selItems.push(i)}h=g=true}else{if(i.$instanceof(zul.sel.Listhead)){this.listhead=i}else{if(i.$instanceof(zul.mesh.Paging)){this.paging=i}else{if(i.$instanceof(zul.sel.Listfoot)){this.listfoot=i}else{if(i.$instanceof(zul.mesh.Frozen)){this.frozen=i}}}}}this._syncEmpty();if(!e){if(!f&&!h){return this.rerender()}if(g){this._syncStripe()}if(!f){this._syncSize()}if(this.desktop){a(this)}}},removeChild:function(f,e){if(this.$super("removeChild",f,e)){this._fixOnRemove(f,e);return true}},_fixOnRemove:function(i,e){var g;if(i==this.listhead){this.listhead=null}else{if(i==this.paging){this.paging=null}else{if(i==this.frozen){this.frozen=null;this.destroyBar_()}else{if(i==this.listfoot){this.listfoot=null}else{if(!i.$instanceof(zul.mesh.Auxhead)){if(i==this.firstItem){for(var f=this.firstChild,h=zul.sel.Listitem;f&&!f.$instanceof(h);f=f.nextSibling){}this.firstItem=f}if(i==this.lastItem){for(var f=this.lastChild,h=zul.sel.Listitem;f&&!f.$instanceof(h);f=f.previousSibling){}this.lastItem=f}if(b(i)){this._groupsInfo.$remove(i)}--this._nrows;if(i.isSelected()){this._selItems.$remove(i)}g=true}}}}}this._syncEmpty();if(!e){if(g){this._syncStripe()}this._syncSize()}},redrawEmpty_:function(e){e.push('<tbody class="',this.$s("emptybody"),'"><tr><td id="',this.uuid,'-empty" style="display:none">',this._emptyMessage,"</td></tr></tbody>")},replaceChildHTML_:function(k,j,i,h,g){if(k._renderdefer){var e=this.getOddRowSclass(),f=jq(j).hasClass(e);this.$supers("replaceChildHTML_",arguments);if(f){jq(k).addClass(e)}}else{this.$supers("replaceChildHTML_",arguments)}},_syncEmpty:function(){this._shallFixEmpty=true},onChildReplaced_:function(e,f){this.$supers(c,"onChildReplaced_",arguments);if(e){this._fixOnRemove(e,true)}if(f){this._fixOnAdd(f,true,false,true)}if((e&&e.$instanceof(zul.sel.Listitem))||(f&&f.$instanceof(zul.sel.Listitem))){this._syncStripe()}this._syncSize();if(this.desktop){a(this)}},getHeadWidgetClass:function(){return zul.sel.Listhead},itemIterator:_zkf=function(e){return new zul.sel.ItemIter(this,e)},getBodyWidgetIterator:_zkf,_updHeaderCM:function(){var e;if(this._headercm&&this._multiple&&(e=this.listhead)&&(e=e.firstChild)){e._checked=this._isAllSelected()}this.$supers(c,"_updHeaderCM",arguments)},checkOnHighlightDisabled_:function(){if(this._selectOnHighlightDisabled){var e=window.getSelection||document.selection;if(e){if(zk.ie&&zk.ie<9){return e.type=="Text"&&e.createRange().htmlText.length>0}else{return e().toString().length>0}}}}});zul.sel.ItemIter=zk.$extends(zk.Object,{$init:function(f,e){this.box=f;this.opts=e},_init:function(){if(!this._isInit){this._isInit=true;var e=this.box.firstItem;if(this.opts&&this.opts.skipHidden){for(;e&&!e.isVisible();e=e.nextSibling){}}this.p=e}},hasNext:function(){this._init();return this.p},next:function(){this._init();var f=this.p,e=f?f.parent.nextItem(f):null;if(this.opts&&this.opts.skipHidden){for(;e&&!e.isVisible();e=e.parent.nextItem(e)){}}if(f){this.p=e}return f}})})();