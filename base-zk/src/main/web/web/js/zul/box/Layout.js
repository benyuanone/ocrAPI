zul.box.Layout=zk.$extends(zk.Widget,{_spacing:"5px",setSpacing:(function(a,b){return function(c,d){var e=this[a];this[a]=c;if(e!==c||(d&&d.force)){this.__fname__=a.substring(1);b.apply(this,arguments);delete this.__fname__}return this}})("_spacing",(function(){var c=this.$n(),a=this.isVertical_(),b=this._spacing;if(c){jq(c).children("div:not(:last-child)").css("padding-"+(a?"bottom":"right"),(b&&b!="auto")?b:"")}})),getSpacing:_zkf$=function(){return this._spacing},isSpacing:_zkf$,_chdextr:function(a){return a.$n("chdex")||a.$n()},insertChildHTML_:function(e,b,d){if(b){jq(this._chdextr(b)).before(this.encloseChildHTML_(e))}else{var c=jq(this.$n()),a=this._spacing;c.children("div:last-child").css("padding-"+(this.isVertical_()?"bottom":"right"),(a&&a!="auto")?a:"");c.append(this.encloseChildHTML_(e))}e.bind(d)},bind_:function(){this.$supers(zul.box.Layout,"bind_",arguments);zWatch.listen({onResponse:this})},unbind_:function(){zWatch.unlisten({onResponse:this});this.$supers(zul.box.Layout,"unbind_",arguments)},syncSize:function(){this._shallSize=false;if(this.desktop){for(var a=this.firstChild;a;a=a.nextSibling){if(a._nvflex||a._nhflex){zUtl.fireSized(this);break}}}},onResponse:function(){if(this._shallSize){this.syncSize()}},onChildVisible_:function(a){this.$supers("onChildVisible_",arguments);if(this.desktop){this._shallSize=true;a.$n("chdex").style.display=a.isVisible()?"":"none"}},onChildAdded_:function(b){this.$supers("onChildAdded_",arguments);if(this.desktop){var a=b.$n("chdex");this._shallSize=true;if(a){a.style.display=b.isVisible()?"":"none"}}},onChildRemoved_:function(){this.$supers("onChildRemoved_",arguments);if(this.desktop){this._shallSize=true}},removeChildHTML_:function(b){this.$supers("removeChildHTML_",arguments);jq(b.uuid+"-chdex",zk).remove();var a=this.lastChild==b;if(this._spacing!="auto"&&this.lastChild==b){jq(this.$n()).children("div:last-child").css("padding-"+(this.isVertical_()?"bottom":"right"),"")}},encloseChildHTML_:function(h,e){var b=[],c=this.isVertical_(),g=this._spacing;b.push('<div id="',h.uuid,'-chdex" class="',this.$s("inner"),'"');if(g&&g!="auto"){b.push(' style="',!h.isVisible()?"display:none;":"");var f=h.nextSibling;if(f&&!f.$instanceof(zul.wgt.Popup)){b.push("padding-",c?"bottom:":"right:",g)}b.push('"')}b.push(">");h.redraw(b);b.push("</div>");if(!e){return b.join("")}for(var d=0,a=b.length;d<a;++d){e.push(b[d])}},isVertical_:zk.$void,_resetBoxSize:function(b){for(var a=this.firstChild;a;a=a.nextSibling){var c=a.$n("chdex");if(c){if(b&&a._nvflex&&a.getVflex()!="min"){var d;if((d=a.$n())&&(d.scrollTop||d.scrollLeft)){}else{a.setFlexSize_({height:"",width:""})}if(c){c.style.height=""}}if(!b&&a._nhflex&&a.getHflex()!="min"){var d;if((d=a.$n())&&(d.scrollTop||d.scrollLeft)){}else{a.setFlexSize_({height:"",width:""})}if(c){c.style.width=""}}}}},afterResetChildSize_:function(b){for(var a=this.firstChild;a;a=a.nextSibling){var c=a.$n("chdex");if(c){if(b=="h"){c.style.height=""}if(b=="w"){c.style.width=""}c.style.minWidth="1px"}}},resetSize_:function(c){this.$supers(zul.box.Layout,"resetSize_",arguments);var b=this.isVertical_();for(var a=this.firstChild;a;a=a.nextSibling){if(b?(a._nvflex&&a.getVflex()!="min"):(a._nhflex&&a.getHflex()!="min")){var d=a.$n("chdex");if(d){if(c=="h"){d.style.height=""}if(c=="w"){d.style.width=""}}}}},getChildMinSize_:function(b,f){var e=f.$n();if(b=="w"&&f._hflex&&this.isVertical_()){for(var c=f.nextSibling,a=0,d;c;c=c.nextSibling){if(!c._hflex){d=zjq.minWidth(c.$n());a=d>a?d:a}}return a}if(b=="h"){return zk(e.parentNode).contentHeight()}else{return zjq.minWidth(e)}},getContentEdgeHeight_:function(){var b=0;for(var a=this.firstChild;a;a=a.nextSibling){b+=zk(a.$n("chdex")).paddingHeight()}return b},getContentEdgeWidth_:function(){var b=0;for(var a=this.firstChild;a;a=a.nextSibling){b+=zk(a.$n("chdex")).paddingWidth()}return b},beforeChildrenFlex_:function(j){this._shallSize=false;j._flexFixed=true;var y=this.isVertical_(),B=[],G=y?0:1,a=[],D=!y?0:1,r=this.$n(),o=j.getParentSize_(r),q=zk(r),m=o.height,t=o.width,v=this.firstChild,f;if(!zk.mounting){this._resetBoxSize(y)}if(q.hasVScroll()){t-=(f=jq.scrollbarWidth())}if(q.hasHScroll()){m-=f||jq.scrollbarWidth()}for(;v;v=v.nextSibling){var A;if(v.isVisible()&&!(A=zk(v)).hasVParent()){var i=v,E=i.$n(),l=E.parentNode,d=zk(l);if(v&&v._nvflex){if(i!==j){i._flexFixed=true}if(i._vflex=="min"){i.fixMinFlex_(E,"h");var x=E.offsetHeight+A.marginHeight()+d.padBorderHeight();l.style.height=jq.px0(x);if(y){m-=l.offsetHeight+d.marginHeight()}}else{B.push(i);if(y){G+=i._nvflex;m=m-d.marginHeight()}}}else{if(y){var g=i.$instanceof(zul.wgt.Label)||i.$instanceof(zul.wgt.Span)||i.$instanceof(zul.wgt.Div)||i.$instanceof(zul.wgt.A);m-=(g&&zk.ie>8?1:0)+l.offsetHeight+d.marginHeight()}}if(i&&i._nhflex){if(i!==j){i._flexFixed=true}if(i._hflex=="min"){i.fixMinFlex_(E,"w");var n=E.offsetWidth+A.marginWidth()+d.padBorderWidth();l.style.width=jq.px0(d.revisedWidth(n));if(!y){t-=l.offsetWidth+d.marginWidth()}}else{a.push(i);if(!y){D+=i._nhflex;t=t-d.marginWidth()}}}else{if(!y){t-=l.offsetWidth+d.marginWidth()}}}}var F=m>0?m:0;while(B.length>1){var i=B.shift(),C=(y?(i._nvflex*m/G):m)|0,k=i.$n().offsetTop,s=C-((zk.ie<11&&k>0)?(k*2):0),u=i.$n("chdex"),e=zk(u).padBorderHeight(),z=!i.$n().style.height;i.setFlexSize_({height:s-e});i._vflexsz=C-e;u.style.height=jq.px0(C);if(y){F-=C}if(!z&&y&&i!==j){zUtl.fireSized(i)}}if(B.length){var i=B.shift(),k=i.$n().offsetTop,s=F-((zk.ie<11&&k>0)?(k*2):0),u=i.$n("chdex"),e=zk(u).padBorderHeight(),z=!i.$n().style.height;i.setFlexSize_({height:s-e});i._vflexsz=F-e;u.style.height=jq.px0(F);if(!z&&y&&i!==j){zUtl.fireSized(i)}}F=t>0?t:0;while(a.length>1){var i=a.shift(),b=(y?t:(i._nhflex*t/D))|0,u=i.$n("chdex"),e=zk(u).padBorderWidth(),z=!i.$n().style.width;i.setFlexSize_({width:b-e});i._hflexsz=b-e;u.style.width=jq.px0(b);if(!y){F-=b}if(!z&&!y&&i!==j){zUtl.fireSized(i)}}if(a.length){var i=a.shift(),u=i.$n("chdex"),e=zk(u).padBorderWidth(),z=!i.$n().style.width;i.setFlexSize_({width:F-e});i._hflexsz=F-e;u.style.width=jq.px0(F);if(!z&&!y&&i!==j){zUtl.fireSized(i)}}j.parent.afterChildrenFlex_(j);j._flexFixed=false;return false},afterChildrenMinFlex_:function(a){var b=this.$n();if(a=="h"){if(this.isVertical_()){var i=0;for(var k=b.firstChild;k;k=k.nextSibling){var e=k.firstChild;if(e.style.height){var d=e.offsetHeight+zk(k).padBorderHeight()+zk(e).marginHeight();k.style.height=jq.px0(d);i+=d}else{i+=k.offsetHeight}}b.style.height=jq.px0(i)}else{var j=0;for(var k=b.firstChild;k;k=k.nextSibling){var f=k.offsetHeight;if(f>j){j=f}}b.style.height=jq.px0(j)}}else{if(!this.isVertical_()){var i=0;for(var k=b.firstChild;k;k=k.nextSibling){var e=k.firstChild;if(e.style.width){var g=e.offsetWidth+zk(k).padBorderWidth()+zk(e).marginWidth();k.style.width=jq.px0(g);i+=g}else{i+=k.offsetWidth}}if((zk.ie>8)&&this._hflexsz){i=Math.max(this._hflexsz,i)}b.style.width=jq.px0(i)}else{var j=0;for(var k=b.firstChild;k;k=k.nextSibling){var c=k.firstChild.offsetWidth;if(c>j){j=c}}if((zk.ie>8)&&this._hflexsz){j=Math.max(this._hflexsz,j)}b.style.width=jq.px0(j)}}}});