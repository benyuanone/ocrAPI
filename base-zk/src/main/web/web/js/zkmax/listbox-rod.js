(function(){var a=zk.ie<11?1193046:16777216,b={};zk.override(zul.sel.Listbox.prototype,b,{_firstLoad:true,_totalSize:0,_avgrowhgh:21,_offset:0,_lastoffset:0,_limit:20,_bufpad:21*50,_loadpad:21*10,_viewtop:0,_lasttop:0,_totalhgh:null,_rowshgh:null,_topPad:0,_itop:0,_ibottom:0,$init:function(){b.$init.apply(this,arguments);this._padsz={}},domPad_:function(c,d){if(this._listbox$rod){c.push('<div id="',this.uuid,d,'" style="font-size:0px;display:none;width:1px;"></div>')}},setResetDataLoader:function(){this._justScrollPads=this._currentTop=this._currentLeft=this._topPad=this._lasttop=0;this.refreshBar_(false,true);if(this._nativebar&&this.ebody){this.ebody.scrollTop=0}},setTotalSize:function(c){if(this._listbox$rod){if(c!=this._totalSize){this._totalSize=c}if(!this._scrolling&&this.desktop){this._initPadSizes();if(zk.ie<11){this._doScroll()}}}},setItemsInvalid_:function(c){var d=this;zAu.createWidgets(c,function(f){if(d.$n("rows")){var k=f.length&&f[0]?f[0]._index:d._lastoffset;d.replaceCavedChildren_("rows",f);if(!k){d._justScrollPads=false}else{d.setScrollPads_({offset:k})}}else{var h;for(var i=d.firstItem;i;){var l=d.nextItem(i);if(!l){h=i.nextSibling}d.removeChild(i,true);i=l}for(var g=0,e=f.length;g<e;++g){d.insertBefore(f[g],h,true)}}},function(f){for(var e=f,g=f;e;g=e,e=e.parent){if(e==d&&g.$instanceof(zul.sel.Listitem)){return null}}return f})},_fireOnScrollPos:function(d){if(this._listbox$rod){var e=this.inPagingMold(),c=this.inSelectMold();if(!e&&!c){clearTimeout(this._timeoutId);this._timeoutId=setTimeout(this.proxy(this._scrollPage),d>=0?d:300)}else{if(e){b._fireOnScrollPos.apply(this,arguments)}}}else{b._fireOnScrollPos.apply(this,arguments)}},_onRender:function(){if(b._onRender.apply(this,arguments)){return true}if(this._listbox$rod&&!this.inPagingMold()&&!this.inSelectMold()&&this._firstLoad){this._firstLoad=false;if(this.initRodSize){this._bufpad=this.initRodSize/2*21}this._initPadSizes()}},_setPadSize:function(g,d,f){this._padsz[d]=f;var e=g.style;e.display=f?"block":"none";var c=['<table id="',this.uuid,"-",d,'-tbl"',">"];if(!zk.webkit){while(true){c.push('<tr style="height:',Math.min(f,a),'px"><td></td></tr>');f-=a;if(f<=0){break}}}else{while(true){c.push('<tr><td style="height:',Math.min(f,a),'px"></td></tr>');f-=a;if(f<=0){break}}}c.push("</table>");jq(g).empty().append(c.join(""))},_initPadSizes:function(){if(this.inPagingMold()){return}if(this._justScrollPads){delete this._justScrollPads;return}var i=this.$n("rows");if(!i){return}var j=this._nrows,o=this._rowshgh=i.offsetHeight,q=this._totalSize,n=this.ebody,d=this.$n("cave");this._avgrowhgh=j>0?((o/j)|0):21;this._ibottom=this._offset+j;if(this._topPad<0){this._topPad=this._offset*this._avgrowhgh}if(this._offset==0){this._topPad=0}var c=this._topPad,l=q*this._avgrowhgh-o-c;if(l<0){if(this._offset>0){c+=l}l=0;if(c<0){c=0}}else{if(this.tsize<=this._ibottom){l=0}}if(this._topPad!=c){this.fire("onTopPad",{topPad:this._topPad=c})}this._setPadSize(this.$n("tpad"),"tpad",c);this._setPadSize(this.$n("bpad"),"bpad",l);this._totalhgh=this.ebody.scrollHeight;this._itop=this._offset;var r=n.offsetHeight;this._limit=(((r+this._bufpad*2)/this._avgrowhgh)|0)+2;if(!this._viewtop&&!this._lasttop&&this._currentTop>0){this._viewtop=this._lasttop=this._currentTop}if(!this._lastoffset&&this._offset>0){this._lastoffset=this._offset}if(this._totalSize>this._ibottom){var h=this._viewtop=this._currentTop,k=h+r,f=i.lastChild,p=f?this._rowScrollBottom(f):c;if(k>p&&this._lastoffset==this._itop){this.fire("onDataLoading",{offset:this._itop,limit:this._limit})}}this.refreshBar_();if(this._selInView){var e=this._selInView*this._avgrowhgh,m=e+this._avgrowhgh,g=zul.mesh.Scrollbar.getScrollPosV(this);if(m<g||e>(g+this.ebody.offsetHeight)){this.setSelInView_(this._selInView)}delete this._selInView}},_rowScrollBottom:function(c){return c.offsetTop+c.offsetHeight-(this.ebodytbl.offsetParent==c.offsetParent?this.ebodytbl.offsetTop:0)},_rowOffsetTop:function(c){var d=this.$n("rows");return c.offsetTop-(d.offsetParent==c.offsetParent?d.offsetTop:0)},setSelInView_:function(c){var e=c*this._avgrowhgh;var d=this._scrollbar;if(d){if(!d.hasVScroll()){d.syncSize()}d.scrollTo(zul.mesh.Scrollbar.getScrollPosH(this),e)}else{this.ebody.scrollTop=e}},_syncSelInView:function(){if(!this._listbox$rod){b._syncSelInView.apply(this,arguments)}else{if(this.inPagingMold()){if(this._selectedIndex>(this._visiRows-2)){this.setSelInView_(this._selectedIndex)}}}},_scrollPage:function(){this._timeoutId=false;var p=this.$n("rows");if(!p){return}var q=this.ebody,f=this._viewtop=zul.mesh.Scrollbar.getScrollPosV(this),s=f+q.offsetHeight;var g=this._padsz.tpad,m=this._lasttop,t=g,n=this._rowshgh=p.offsetHeight,h=t+n;if(f!=m){var u=f-this._bufpad,r=s+this._bufpad,k=f-this._loadpad,i=s+this._loadpad;if(u<0){u=0}if(k<0){k=0}if(r>this._totalhgh){r=this._totalhgh-(zk.ie<11?1:0)}if(i>this._totalhgh){i=this._totalhgh-(zk.ie<11?1:0)}if(f>m){if(h<i){var d=this._itop;if(h<u){d=this._ibottom+(((u-h)/this._avgrowhgh)|0)}else{var c=u-g;if(c>=0){var o=this._ibottom-1;d=0;for(var e=this.lastItem;e;e=this.previousItem(e),--o){var l=this._rowOffsetTop(e.$n());if(l<c){d=o;break}}}}if(d>=this._totalSize){d=this._totalSize-this._limit}if(d<0||f==0){d=0}if(d!=this._lastoffset||(this._totalSize>this._ibottom&&this._nrows<this._limit)){this._lastoffset=d;this._lasttop=f;this.fire("onDataLoading",{offset:d,limit:this._limit},{rtags:{onDataLoading:1}})}}}else{if(t>=k||(u==0&&this._lastoffset>0)){var d=u==0?0:(this._itop-((t-u)/this._avgrowhgh)|0);if(d>=this._totalSize){d=this._totalSize-this._limit}if(d<0){d=0}if(d!=this._lastoffset){this._lastoffset=d;this._lasttop=f;this.fire("onDataLoading",{offset:d,limit:this._limit},{rtags:{onDataLoading:1}})}}}}this._currentTop=f;this.fire("onScrollPos",{top:this._currentTop,left:this._currentLeft})},setScrollPads_:function(q){var o=q.offset,t=q.sel;this._justScrollPads=true;delete this._scrolling;if(!this._listbox$rod||o!=this._lastoffset){return}var z=this.ebody,y=this.$n("rows"),w=this.$n("cave");if(!y){return}var f=this.$n("tpad"),n=this.$n("bpad"),l=this._padsz.tpad,c=this._padsz.bpad,p=this._rowshgh,s=this._itop,d=this._ibottom,r=this._rowshgh=y.offsetHeight,g=this._totalSize,h=this._itop=o,e=this._ibottom=h+this._nrows;if(h>s){if(h>=d){l=l+p+((o-d)*this._avgrowhgh|0)}else{var x=this.firstItem;for(var u=h;u<d&&x;++u){x=this.nextItem(x)}l=l+p-(x?this._rowOffsetTop(x.$n()):r)}}else{if(h<s){if(e<=s){l=l-((s-o)*this._avgrowhgh|0)}else{var x=this.lastItem;for(var u=e-1;u>s&&x;--u){x=this.previousItem(x)}l=l-(x?this._rowOffsetTop(x.$n()):r)}}}if(o==0){l=0}else{if(l==0){l=o*this._avgrowhgh}}c=this._totalhgh-r-l;var j=c>0&&e>=g;if(j){c=0}if(c<0){j=true;c=((g-e)*this._avgrowhgh)|0}if(this._topPad!=l){this.fire("onTopPad",{topPad:this._topPad=l})}this._setPadSize(f,"tpad",l<0?0:l);this._setPadSize(n,"bpad",c<0?0:c);var i=this._viewtop;if(i>=(this._avgrowhgh*g-this._bufpad)&&i!=z.scrollTop){z.scrollTop=this._currentTop=i}if(l<0||c<0||j){this._totalhgh=z.scrollHeight}if(!zk.mobile&&zul.mesh.Scrollbar.getScrollPosV(this)!=this._lasttop){this._fireOnScrollPos()}if(!zk.mobile&&t){var A=zk.Widget.$(t);if(A){this._syncFocus(A);this._setFocus(A,true)}}},_selectUpto:function(o,m,i){if(!this._listbox$rod){return b._selectUpto.apply(this,arguments)}if(o.isSelected()){if(!i){this._focus(o)}return}var h=o._index,n=false,c=false,j=this._focusItem||this._lastSelectedItem,l=j?j._index:-1;var g;if(h<l){var f=l;l=h;h=f;g=true}for(var e=this.getBodyWidgetIterator(),d=this.getSelectedItem(),k;(k=e.next());){if(k.isDisabled()){continue}if(!n&&l>-1&&k._index>=l){n=true}if(n){this._changeSelect(k,true);if(!g&&k==o){break}g=false}else{if(c){this._changeSelect(k,true);if(this._isFocus(k)||k==j){break}}else{if(!d){if(k!=o){continue}this._changeSelect(k,true);break}}}c=k._index>=h;if(c&&n){break}}if(!i){this._focus(o)}this.fireOnSelectByRange(o,{start:l,end:h},m)},fireOnSelectByRange:function(f,e,c){var g,d=true;if(c){g=c.data;if(this._multiple){d=(g.ctrlKey||g.metaKey)||g.shiftKey||(this._checkmark&&(!this._cdo||(c.domTarget.id&&c.domTarget.id.endsWith("-cm"))))}}this.fire("onSelect",zk.copy({range:e,reference:f,clearFirst:!d},g))}})})();