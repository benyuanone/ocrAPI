(function(){function f(k,j){var i;if(k._rodopen){delete k._rodopen}else{if((i=k.firstChild)&&!k._open&&zkmax.rod(k)){j.push('<div id="',k.uuid,'-pp" style="display:none"></div>');k.z_childrod=true;for(;i;i=i.nextSibling){i.z_rod=true}return true}}delete k.z_childrod}function h(k){var i;if((i=k.firstChild)&&i.z_rod&&(!k.parent||!k.parent.z_rod)){k._rodopen=true;var j=[];k.redrawpp_(j);jq("#"+k.uuid+"-pp").replaceWith(j.join(""));for(;i;i=i.nextSibling){i.unbind();i.bind(k.desktop)}k.clearCache()}}function e(v){var t=v.getTime().getFullYear(),n=v.getFormat(),l=[],m={},u={},k=v._localizedSymbols||{SMON:zk.SMON};jq.each(["y","m","d"],function(o,j){var o=n.search(new RegExp(j,"i"));if(o>-1){l.push({o:o,v:j})}});l.sort(function(j,i){return j.o>i.o?1:-1});jq.each(l,function(o,j){m[j.v]=o});for(var r=0;r<l.length;r++){if(r==m.y){u.y={};var s=v._beg?v._beg.getFullYear():1900,p=v._end?v._end.getFullYear():2099;for(var q=s;q<=p;q++){u.y[q]=q}}else{if(r==m.m){u.m={};for(var q=0;q<12;q++){u.m[q]=k.SMON[q]}}else{if(r==m.d){u.d={};for(var q=1;q<32;q++){u.d[q]=n.match(/dd/i)&&q<10?"0"+q:q}}}}}return u}function g(D){var B=D.parent;if(B&&B.$instanceof(zul.db.Datebox)){var y={},n=B.getTimeFormat(),z=n.search(/H/),t=n.search(/h/),v=n.search(/K/),q=n.search(/k/),o=n.search(/m/i),C=n.search(/s/i),x=n.search(/a/i);if(z>-1||t>-1||v>-1||q>-1){y.hr={};var u=n.match(/hh/i)||n.match(/kk/i);if(z>-1||q>-1){var l=z>-1?0:1,p=l+24;for(var r=l;r<p;r++){y.hr[r]=u&&r<10?"0"+r:r}}else{if(t>-1||v>-1){var l=t>-1?1:0,p=l+12;for(var r=l;r<p;r++){y.hr[r]=u&&r<10?"0"+r:r}}}}if(o>-1){y.mi={};for(var r=0;r<60;r++){y.mi[r]=n.match(/mm/i)&&r<10?"0"+r:r}}if(C>-1){y.ss={};for(var r=0;r<60;r++){y.ss[r]=n.match(/ss/i)&&r<10?"0"+r:r}}if(x>-1){var j=D._localizedSymbols||{APM:zk.APM},A=j.APM;y.aa={};y.aa[A[0]]=A[0];y.aa[A[1]]=A[1]}return y}}function b(j,i){return(j==i)||(j&&i&&j.getTime()==i.getTime())}var a={},d={},c={};zk.override(zul.db.Datebox.prototype,a,{setFormat:function(){a.setFormat.apply(this,arguments);this.rerender()},redrawpp_:function(i){if(!f(this,i)){i.push('<div id="',this.uuid,'-pp" class="',this.$s("popup"),'" style="display:none">');this.firstChild.redraw(i);i.push("</div>")}}});zk.override(zul.db.CalendarPop.prototype,d,{_scrollbar:null,_innerHeight:jq.innerHeight(),setValue:function(i){if(this._value!=i){this._value=i}},bind_:function(){this.$supers(zul.db.CalendarPop,"bind_",arguments);var j=this.$n("set"),i=this.$n("cancel");this.$n().style.width="auto";this.domListen_(j,"onClick","_doSet").domListen_(i,"onClick","_doCancel");this._initBar();zWatch.listen({onSize:this,onFloatUp:this})},unbind_:function(){zWatch.unlisten({onSize:this,onFloatUp:this});this._destroyBar();var j=this.$n("set"),i=this.$n("cancel");this.domUnlisten_(j,"onClick","_doSet").domUnlisten_(i,"onClick","_doCancel");this.$supers(zul.db.CalendarPop,"unbind_",arguments)},onSize:function(){this._innerHeight=jq.innerHeight()},_initBar:function(){var j=this,i={snap:"li",hscroll:false,hScrollbar:false,vScrollbar:false,onScrollEnd:function(){j._scrollover();j._validate()}};j._scrollbar={};jq.each(["y","m","d"],function(m,l){var k=j.$n(l);if(k){j._scrollbar[l]=new iScroll(k.children[0],i)}})},_destroyBar:function(){var i=this;jq.each(["y","m","d"],function(k,j){var l=i._scrollbar[j];if(l){l.destroy();l=i._scrollbar[j]=null}});i._scrollbar=null},_refreshBar:function(){var l=this,j=l.getTime(),i=0,k={y:j.getFullYear(),m:j.getMonth(),d:j.getDate()-1};jq.each(["y","m","d"],function(n,m){var p=l._scrollbar[m];if(p){var o=l.$n(m).offsetHeight/3;p.refresh();if(m=="y"){k[m]=Math.abs(jq(p.scroller.children[1]).data("val")-k[m])}p.scrollTo(0,-k[m]*o,0)}})},_doSet:function(j){var m=this,l={},k=m.parent;jq.each(["y","m","d"],function(o,n){var q=m._scrollbar[n];if(q){var p=m.$n(n).offsetHeight/3,r=-q.y/p+1;l[n]=jq(q.scroller.children[r]).data("val")}});var i=k.getTimeFormat();if(i){k._tm._doSetTime(i,true)}m._setTime(l.y,l.m,l.d,true);if(k._readonly){j.stop()}},_doCancel:function(i){this.close();if(this.parent._readonly){i.stop()}},_validate:function(){if(!this.lenient){var n=this,j=0,l={};jq.each(["y","m","d"],function(p,m){j=n.$n(m).offsetHeight/3;var q=n._scrollbar[m],r=-q.y/j+1;l[m]=jq(q.scroller.children[r]).data("val")});var i=l.m,k=l.d,o=l.y;if(i==1){if(o%4==0&&((o%100!=0)||(o%400==0))){if(k>29){n._scrollbar.d.scrollTo(0,-28*j,0)}}else{if(k>28){n._scrollbar.d.scrollTo(0,-27*j,0)}}}else{if(i==3||i==5||i==8||i==10){if(k>30){n._scrollbar.d.scrollTo(0,-29*j,0)}}}}},_scrollover:function(){var j=this,i=j.$s("wheel-list-selected");jq.each(["y","m","d"],function(m,k){var o=j._scrollbar[k];if(o){var n=j.$n(k).offsetHeight/3,p=-o.y/n+1,l=o.scroller;jq.each(l.children,function(){var q=jq(this);if(q.hasClass(i)){q.removeClass(i)}});jq(l.children[p]).addClass(i)}})},redraw:function(l){var j=this,n=this.uuid,p=e(this),o=function(i){return j.$s("wheel-"+i)};l.push('<div id="',n,'"',this.domAttrs_(),">",'<div id="',n,'-cave" class="',o("cave"),'">');l.push('<div class="',o("body"),'"><div class="',o("date"),'"><div class="',o("line"),'"></div>');for(var k in p){l.push('<div id="',n,"-",k,'" class="',o("list"),'"><ul><li data-val="-1"></li>');for(var m in p[k]){l.push('<li data-val="',m,'">',p[k][m],"</li>")}l.push('<li data-val="0"></li>',"</ul></div>")}l.push("</div>");this.parent._tm.redraw(l);l.push("</div>");l.push('<div class="',o("footer"),'">','<button id="',n,'-set" class="',o("button")," ",o("left"),'">',msgzul.OK,"</button>",'<button id="',n,'-cancel" class="',o("button")," ",o("right"),'">',msgzul.CANCEL,"</button>","</div></div></div>")},close:function(i){d.close.apply(this,arguments);this._open=false},open:function(o){var v=this.parent;h(v);var t=v.$n(),k=v.$n("pp");if(!t||!k){return}this._open=true;var w=this,s=w.$n(),x=jq(k),n=k.style,l=v.getTimeFormat(),p=v.getInputNode(),q=zul.db.Datebox._unformater,r=q?q(p.value):null;if(!r){r=new zk.fmt.Calendar(zk.fmt.Date.parseDate(p.value,v._format,false,v._value,w._localizedSymbols),w._localizedSymbols).toUTCDate()||(p.value?v._value:zUtl.today(l))}if(r){w.setValue(r)}if(l){var u=v._tm;u.setFormat(l);u.setValue(r||new Date())}v.setFloating_(true,{node:k});zWatch.fire("onFloatUp",v);n.position="absolute";k.className=t.className+" "+k.className;x.removeClass(v.$s());var j=jq.now()+2000,i=w._innerHeight,m=function(){if(zk.android){if(!w._open){return}if(i-jq.innerHeight()>=20&&jq.now()<j){setTimeout(m,50);return}}n.display="block";var B=w.setTopmost(),y=s.offsetHeight,C=x.zk;n.zIndex=B>0?B:1;n.width=jq.px(jq.innerWidth()-20);n.height=jq.px(y);n.top=jq.px(i);x.zk.makeVParent();x.transition({y:-y+"px",easing:"ease-in-out",duration:C.getAnimationSpeed(300)});delete v._shortcut;w._refreshBar();var A=v.getTimeFormat(),z=v._tm;if(A){z._refreshBar(v.getValue()||new Date(),A)}};m()},doSwipe_:function(i){this._swipeable=false}});zk.override(zul.db.CalendarTime.prototype,c,{bind_:function(){var i=this.parent;if(i&&i.$instanceof(zul.db.Datebox)){this.setFormat(i.getTimeFormat())}c.bind_.apply(this,arguments)},unbind_:function(){c.unbind_.apply(this,arguments)},redraw:function(m){var n=this.uuid,i=this.parent.getTimeFormat();m.push("<i",this.domAttrs_({text:true}),' style="display: none">','<input id="',n,'-real"','class="',this.$s("input"),'"',this.textAttrs_(),"/></i>");if(i){var o=g(this);m.push('<div class="',this.$s("wheel-time"),'"><div class="',this.$s("wheel-line"),'"></div>');for(var l in o){m.push('<div id="',n,"-",l,'" class="',this.$s("wheel-list"),'"><ul>','<li data-val="-1"></li>');for(var k in o[l]){m.push('<li data-val="',k,'">',o[l][k],"</li>")}m.push('<li data-val="0"></li>',"</ul></div>")}m.push("</div>")}}});zul.db.DateboxCtrl.isPreservedFocus=function(i){return false}})();