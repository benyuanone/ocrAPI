(function(){var b={},c=zul.db.Timebox;function d(z){var u={},g=z.getFormat(),v=g.search(/H/),p=g.search(/h/),r=g.search(/K/),n=g.search(/k/),j=g.search(/m/i),y=g.search(/s/i),t=g.search(/a/i);if(v>-1||p>-1||r>-1||n>-1){u.hr={};var q=g.match(/hh/i)||g.match(/kk/i);if(v>-1||n>-1){t=-1;var f=v>-1?0:1,l=f+24;for(var o=f;o<l;o++){u.hr[o]=q&&o<10?"0"+o:o}}else{if(p>-1||r>-1){var f=p>-1?1:0,l=f+12;for(var o=f;o<l;o++){u.hr[o]=q&&o<10?"0"+o:o}}}}if(j>-1){u.mi={};for(var o=0;o<60;o++){u.mi[o]=g.match(/mm/i)&&o<10?"0"+o:o}}if(y>-1){u.ss={};for(var o=0;o<60;o++){u.ss[o]=g.match(/ss/i)&&o<10?"0"+o:o}}if(t>-1){var e=z._localizedSymbols||{APM:zk.APM},x=e.APM;u.aa={};u.aa[x[0]]=x[0];u.aa[x[1]]=x[1]}return u}function a(f,e){return(f==e)||(f&&e&&f.getTime()==e.getTime())}zk.override(zul.db.Timebox.prototype,b,{_scrollbar:null,_innerHeight:jq.innerHeight(),onSize:function(){this._innerHeight=jq.innerHeight();b.onSize.apply(this,arguments)},_initBar:function(){var f=this,e={snap:"li",hscroll:false,hScrollbar:false,vScrollbar:false,onScrollEnd:function(){f._scrollover()}};f._scrollbar={};jq.each(["hr","mi","ss","aa"],function(j,h){var g=f.$n(""+h);if(g){f._scrollbar[h]=new iScroll(g.children[0],e);f._scrollbar[h]._zdeceleration=0.0002}})},_destroyBar:function(){var e=this;jq.each(["hr","mi","ss","aa"],function(g,f){var h=e._scrollbar[f];if(h){h.destroy();h=e._scrollbar[f]=null}});e._scrollbar=null},_refreshBar:function(j,i){var r=this,o=j.getHours(),p=i.search(/H/),m=i.search(/h/),l=i.search(/k/),n=i.search(/K/),f=this._scrollbar.aa,g={mi:j.getMinutes(),ss:j.getSeconds()};var q=0;if(p>-1||l>-1){q=o==0&&l>-1?23:(l>-1?o-1:o)}else{if(m>-1||n>-1){q=o>12?(n>-1?o-12:o-13):(n>-1?o:o-1);if(o==12){q=n>-1?0:11}if(o==0&&m>-1){q=11}}}var e=f&&o>=12?1:0;if(o==0&&l>-1){e=0}g.hr=q;g.aa=e;jq.each(["hr","mi","ss","aa"],function(s,k){var u=r._scrollbar[k];if(u){var t=r.$n(k).offsetHeight/3;u.refresh();u.scrollTo(0,-g[k]*t,0)}})},_scrollover:function(){var f=this,e=f.$s("wheel-list-selected");jq.each(["hr","mi","ss","aa"],function(k,g){var m=f._scrollbar[g];if(m){var l=f.$n(g).offsetHeight/3,n=-m.y/l+1,j=m.scroller;jq.each(j.children,function(){var h=jq(this);if(h.hasClass(e)){h.removeClass(e)}});jq(j.children[n]).addClass(e)}})},_doSet:function(){this._doSetTime(this.getFormat());this.close()},_doSetTime:function(h,j){var o=this,g={},k=h.search(/a/i),p=h.search(/s/i),l=new Date(),i=o.getValue();jq.each(["hr","mi","ss","aa"],function(r,q){var t=o._scrollbar[q];if(t){var s=o.$n(q).offsetHeight/3,u=-t.y/s+1;g[q]=jq(t.scroller.children[u]).data("val")}});if(k>-1){var f=o._localizedSymbols||{APM:zk.APM},n=f.APM,e=g.aa,m=g.hr;if(e==n[1]&&m<12){g.hr+=12}if(e==n[0]&&m==12){g.hr+=12}}l.setHours(g.hr,g.mi);if(p>-1){l.setSeconds(g.ss,0)}if(!a(l,i)){o._changed=true;o.setValue(l);if(!j&&o.getErrorMessage()==null){o.fireOnChange()}}},_doCancel:function(){this.close()},onFloatUp:function(f){if(jq(this.$n("pp")).is(":animated")||(!this._inplace&&!this._open)){return}var g=f.origin;if(!zUtl.isAncestor(this,g)){if(this._open){this.close({sendOnOpen:true})}if(this._inplace){var h=this.$n(),e=this.getInplaceCSS();if(jq(h).hasClass(e)){return}h.style.width=jq.px0(zk(h).revisedWidth(h.offsetWidth));jq(this.getInputNode()).addClass(e);jq(h).addClass(e);this.onSize();h.style.width=this.getWidth()||""}}},setOpen:function(e,f){if(this.isRealVisible()){if(e){this.open(f)}else{this.close(f)}}},open:function(f){if(this._open){return}this._open=true;if(f&&f.focus){this.focus()}var h=this.$n("pp");if(!h){return}var l=this,k=l.$n("cave"),m=jq(h),j=h.style;this.setFloating_(true,{node:h});zWatch.fire("onFloatUp",this);j.position="absolute";var g=jq.now()+2000,e=l._innerHeight,i=function(){if(zk.android){if(!l._open){return}if(e-jq.innerHeight()>=5&&jq.now()<g){setTimeout(i,50);return}}j.display="block";var o=l.setTopmost(),n=k.offsetHeight,p=zk(h);j.zIndex=o>0?o:1;j.width=jq.px(jq.innerWidth()-20);j.height=jq.px(n);j.top=jq.px(e);p.makeVParent();zWatch.fireDown("onVParent",l);jq(h).transition({y:-n+"px",easing:"ease-in-out",duration:p.getAnimationSpeed(300)});l._refreshBar(l.getValue()||new Date(),l.getFormat())};i()},close:function(f){if(!this._open){return}this._open=false;if(f&&f.focus){this.focus()}else{jq(this.$n()).removeClass(this.$s("focus"))}var e=this.$n("pp");if(!e){return}e.style.display="none";e.style.WebkitTransition="";e.style.WebkitTransform="";this.setFloating_(false);zWatch.fireDown("onHide",this);zk(e).undoVParent();zWatch.fireDown("onVParent",this);if(this._shadow){this._shadow.destroy();this._shadow=null}},bind_:function(){this.$supers(zul.db.Timebox,"bind_",arguments);var e,h=this.getInputNode();if(this._inplace){jq(h).addClass(this.getInplaceCSS())}if(e=this.$n("btn")){this.domListen_(e,zk.android?"onTouchstart":"onClick","_doBtnClick")}var g=this.$n("set"),f=this.$n("cancel");this.domListen_(g,"onClick","_doSet").domListen_(f,"onClick","_doCancel");this._initBar();zWatch.listen({onSize:this,onFloatUp:this});if(!zk.css3){jq.onzsync(this)}},unbind_:function(){var e;if(e=this._pop){e.close(true)}if(e=this.$n("btn")){this.domUnlisten_(e,zk.android?"onTouchstart":"onClick","_doBtnClick")}var g=this.$n("set"),f=this.$n("cancel");this.domUnlisten_(g,"onClick","_doSet").domUnlisten_(f,"onClick","_doCancel");this._destroyBar();zWatch.unlisten({onSize:this,onFloatUp:this});if(!zk.css3){jq.unzsync(this)}this.$supers(zul.db.Timebox,"unbind_",arguments)},_doBtnClick:function(e){if(!this._buttonVisible){return}if(!this._disabled){this.setOpen(!jq(this.$n("pp")).zk.isVisible(),zul.db.DateboxCtrl.isPreservedFocus(this))}e.stop()},doClick_:function(e){if(!this._disabled){if(e.domTarget==this.$n("pp")){this.close({focus:zul.inp.InputCtrl.isPreservedFocus(this),sendOnOpen:true})}else{if(this._readonly&&!this.isOpen()&&this._buttonVisible){this.open({focus:zul.inp.InputCtrl.isPreservedFocus(this),sendOnOpen:true})}}this.$supers("doClick_",arguments)}},_btnOver:zk.$void,redraw:function(f){var h=this.uuid,g=this._buttonVisible;f.push("<span",this.domAttrs_({text:true}),">",'<input id="',h,'-real"','class="',this.$s("input"));if(!g){f.push(" ",this.$s("rightedge"))}f.push('" autocomplete="off"',this.textAttrs_(),'/><a id="',h,'-btn" class="',this.$s("button"));if(!g){f.push(" ",this.$s("disabled"))}var e=this.$s("icon")+" z-icon-clock-o";f.push('"><i class="',e,'"></i></a>');this.redrawpp_(f);f.push("</span>")},redrawpp_:function(k){var p=this,e=this.uuid,g=this.getFormat(),m=this._itemHeight,f=this._items*m,l=d(this),o=function(h){return p.$s("wheel-"+h)};k.push('<div id="',this.uuid,'-pp" class="',this.$s("popup"),'" style="display:none">','<div id="',e,'-cave" class="',o("cave"),'">','<div class="',o("body"),'"><div class="',o("time"),'" style="width: 100%;"><div class="',o("line"),'"></div>');for(var n in l){k.push('<div id="',e,"-",n,'" class="',o("list"),'"><ul><li data-val="-1"></li>');for(var i in l[n]){k.push('<li data-val="',i,'">',l[n][i],"</li>")}k.push('<li data-val="0"></li></ul></div>')}k.push("</div></div>",'<div class="',o("footer"),'">','<button id="',e,'-set" class="',o("button")," ",o("left"),'">',msgzul.OK,"</button>",'<button id="',e,'-cancel" class="',o("button")," ",o("right"),'">',msgzul.CANCEL,"</button>","</div></div></div>")}})})();