(function(){var c=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1)}})(),a=(function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout})(),b=null;function d(e){return e>>0}zkmax.layout.Scrollview=zk.$extends(zul.box.Layout,{_orient:"vertical",_zdeceleration:0.0006,_start:null,_end:null,_time:null,_pos:null,_startPos:null,_steps:null,_dir:null,_fixedScrollbar:zk.android,_aniTime:null,_outBound:false,_outBoundLT:false,setOrient:(function(e,f){return function(g,h){var i=this[e];this[e]=g;if(i!==g||(h&&h.force)){this.__fname__=e.substring(1);f.apply(this,arguments);delete this.__fname__}return this}})("_orient",(function(){this.rerender()})),getOrient:_zkf$=function(){return this._orient},isOrient:_zkf$,domClass_:function(f){var e=this.$supers(zkmax.layout.Scrollview,"domClass_",arguments);e+=" "+(this.isVertical_()?this.$s("vertical"):this.$s("horizontal"));return e},bind_:function(){this.$supers(zkmax.layout.Scrollview,"bind_",arguments);var e=this.$n();if(zk.mobile){this._pos=[0,0];this._startPos=[0,0];this.domListen_(e,"onTouchStart","doTouchStart_");e.style[zk.vendor+"TransitionProperty"]="-"+zk.vendor_+"-transform";zWatch.listen({onSize:this,onResponse:this})}else{jq(e).css("overflow","auto")}},unbind_:function(){if(zk.mobile){this._pos=null;this._startPos=null;zWatch.unlisten({onSize:this,onResponse:this});var e=this.$n();this.domUnlisten_(e,"onTouchStart","doTouchStart_")}this.$supers(zkmax.layout.Scrollview,"unbind_",arguments)},onSize:function(){if(zk.mobile){var e=this;setTimeout(function(){if(e.desktop){e._refresh()}},200)}},doResizeScroll_:function(){this.$supers("doResizeScroll_",arguments);if(zk.mobile){this._refresh();this._scrollTo(this._pos[0],this._pos[1],0)}},isVertical_:function(){return this.getOrient()=="vertical"},_refresh:function(){var e=this.$n(),f=zk(e),g=this.$n("cave");this._viewW=f.revisedWidth(e.offsetWidth)||1;this._viewH=f.revisedHeight(e.offsetHeight)||1;this._fixCaveSize();this._caveW=g.offsetWidth;this._caveH=g.offsetHeight;this._maxCaveX=this._viewW-this._caveW;this._maxCaveY=this._viewH-this._caveH;this._hBar=this._caveW>this._viewW;this._vBar=this._caveH>this._viewH;this._removeBar("_h");this._removeBar("_v");this._addBar("_h");this._addBar("_v")},_fixCaveSize:function(){var e=this.$n(),g=this.$n("cave"),f=g.style;f.height="";f.width="";if(g.offsetHeight&&g.offsetWidth){}f.height=g.scrollHeight>e.offsetHeight?jq.px(g.scrollHeight):"100%";f.width=g.scrollWidth>e.offsetWidth?jq.px(g.scrollWidth):"100%"},_removeBar:function(f){if(this[f+"Bar"]){var e=f+"BarView",g=f+"BarCave";if(this[e]){this[g].style[zk.vendor+"Transform"]="";this[e].parentNode.removeChild(this[e]);this[g]=this[e]=null}}},_addBar:function(i){if(!this[i+"Bar"]){return}var k,g=i=="_h",e=i+"BarView";if(!this[e]){k=document.createElement("div");var h=k.style;k.className=this.$s("scrollbar");this.$n().appendChild(k);this[e]=k;k=document.createElement("div");k.style[zk.vendor+"TransitionProperty"]="-"+zk.vendor_+"-transform";k.className=this.$s("scrollbar-indicator");this[e].appendChild(k);this[i+"BarCave"]=k;k=null}if(g){var f=this._hBarView.clientWidth;this._hBarCaveSize=Math.max(d(f*f/this._caveW),8);this._hBarCave.style.width=this._hBarCaveSize+"px";this._hBarMaxScroll=f-this._hBarCaveSize;this._hBarProp=this._hBarMaxScroll/this._maxCaveX}else{var j=this._vBarView.clientHeight;this._vBarCaveSize=Math.max(d(j*j/this._caveH),8);this._vBarCave.style.height=this._vBarCaveSize+"px";this._vBarMaxScroll=j-this._vBarCaveSize;this._vBarProp=this._vBarMaxScroll/this._maxCaveY}this._barPos(this._pos,i,true)},_barPos:function(i,f,h){if(!this[f+"Bar"]){return}var e=f=="_h",i=e?i[0]:i[1],g;i=this[f+"BarProp"]*i;if(i<0){if(!this._fixedScrollbar){g=this[f+"BarCaveSize"]+d(i*3);if(g<8){g=8}this[f+"BarCave"].style[f=="h"?"width":"height"]=g+"px"}i=0}else{if(i>this[f+"BarMaxScroll"]){if(!this._fixedScrollbar){g=this[f+"BarCaveSize"]-d((i-this[f+"BarMaxScroll"])*3);if(g<8){g=8}this[f+"BarCave"].style[e?"width":"height"]=g+"px";i=this[f+"BarMaxScroll"]+(this[f+"BarCaveSize"]-g)}else{i=this[f+"BarMaxScroll"]}}}this[f+"BarView"].style.opacity=h?"0":"1";this[f+"BarCave"].style[zk.vendor+"Transform"]="translate3d("+(e?i+"px,0":"0,"+i+"px")+", 0)"},_move:function(e){e[0]=this._hBar?e[0]:0;e[1]=this._vBar?e[1]:0;this.$n("cave").style[zk.vendor+"Transform"]="translate3d("+e[0]+"px, "+e[1]+"px, 0)";this._unloadBoundary();if(this.isListen("onScroll")&&this._outBound){this._loadBoundary()}this._pos=e;this._barPos(e,"_v");this._barPos(e,"_h")},_calcMomentum:function(k,e,i,m,l){var j=this._zdeceleration,f=Math.abs(k)/e,g=(f*f)/(2*j),n=0,h=0;if(k>0&&g>i){h=l/(6/(g/f*j));i=i+h;f=f*i/g;g=i}else{if(k<0&&g>m){h=l/(6/(g/f*j));m=m+h;f=f*m/g;g=m}}g=g*(k<0?-1:1);n=f/j;return{dist:g,time:d(n)}},_resetPos:function(i){var k=this._pos,h=this._maxCaveX,f=this._maxCaveY,j=k[0]>=0?0:k[0]<h?h:k[0],g=k[1]>=0?0:k[1]<f?f:k[1];if(j==k[0]&&g==k[1]){if(this._moved){this._moved=false}if(this._hBarView){var e=this._hBarView.style;e[zk.vendor+"TransitionDelay"]=zk.android?"0":"50ms";e.opacity="0"}if(this._vBarView){var e=this._vBarView.style;e[zk.vendor+"TransitionDelay"]=zk.android?"0":"50ms";e.opacity="0"}this._unloadBoundary();return}this._scrollTo(j,g,i||0)},_scrollTo:function(e,n,k,j){var h=e,m=this._pos;this._stop();if(!h.length){h=[{x:e,y:n,time:k,relative:j}]}for(var g=0,f=h.length;g<f;g++){if(h[g].relative){h[g].x=m[0]-h[g].x;h[g].y=m[1]-h[g].y}this._steps.push({x:h[g].x,y:h[g].y,time:h[g].time||0})}this._startAnima()},_stop:function(){a(this._aniTime);this._steps=[];this._moved=false;this._animating=false},_startAnima:function(){var m=this,l=this._pos,h=Date.now(),k,f=this._maxCaveX,e=this._maxCaveY,j=this.isVertical_();if(this._animating){return}if(!this._steps.length){this._resetPos(300);return}var i=this._steps.shift();if(i.x==l[0]&&i.y==l[1]){i.time=0}this._animating=true;this._moved=true;var g=function(){var n=Date.now(),p,o;if(n>=h+i.time){m._move([i.x,i.y]);m._animating=false;m._startAnima();return}n=(n-h)/i.time-1;k=Math.sqrt(1-n*n);p=(i.x-l[0])*k+l[0];o=(i.y-l[1])*k+l[1];if((!j&&(p>0||p<f))||(j&&(o>0||o<e))){m._outBound=true;m._outBoundLT=p>0||o>0?true:false}else{m._outBound=false}m._move([p,o]);if(m._animating){m._aniTime=c(g)}};g()},_loadBoundary:function(){var m=this.$n("load"),g=m.style,f=this.$s("load-"+this._dir);g.display="block";var i=this.$n("load-image");jq(i).removeClass();jq(i).addClass(f);var l=this.isVertical_(),e=this._viewW-i.offsetWidth,j=this._viewH-i.offsetHeight,k=[l?e/2:(this._outBoundLT?0:e),l?(this._outBoundLT?0:j):j/2];g.left=jq.px(k[0]);g.top=jq.px(k[1])},_unloadBoundary:function(){this.$n("load").style.display="none";jq(this.$n("load-image")).removeClass()},doTouchStart_:function(o){if(b){return}var h=o.domEvent.originalEvent,n=h.touches?h.touches[0]:h,e=h.target,k=["SELECT","INPUT","TEXTAREA","A","BUTTON","LI","DIV"];while(e.nodeType!=1){e=e.parentNode}for(var q,g,p;e;e=e.parentNode){q=e.tagName;g=jq.inArray(q,k);p=jq(e);if(g>-1&&g!=6){return}if(g==6&&p&&p.css("cursor")=="pointer"){return}}b=this.$n();h.preventDefault();var m=getComputedStyle(this.$n("cave"),null)[zk.vendor+"Transform"].replace(/[^0-9-.,]/g,"").split(","),l=m[4]*1,j=m[5]*1,i=this._pos;if(l!=i[0]||j!=i[1]){a(this._aniTime);this._steps=[];this._move([l,j])}this._moved=false;this._animating=false;this._outBound=false;this._outBoundLT=false;this._start=[n.pageX,n.pageY];this._startPos=this._pos;this._time=h.timeStamp||Date.now();var f=this.$n();this.domListen_(f,"onTouchMove","doTouchMove_").domListen_(f,"onTouchEnd","doTouchEnd_")},doTouchMove_:function(q){var l=q.domEvent.originalEvent,n=l.touches?l.touches[0]:l,h=this._start,o=[n.pageX-h[0],n.pageY-h[1]],r=[Math.abs(o[0]),Math.abs(o[1])],m=this._pos,j=[m[0]+o[0],m[1]+o[1]],i=l.timeStamp||Date.now(),f=this._maxCaveX,e=this._maxCaveY,k=this.isVertical_();this._start=[n.pageX,n.pageY];this._outBound=false;if(!k&&(j[0]>0||j[0]<f)){j[0]=m[0]+(o[0]/2);this._outBound=true;this._outBoundLT=j[0]>0?true:false}if(k&&(j[1]>0||j[1]<e)){j[1]=m[1]+(o[1]/2);this._outBound=true;this._outBoundLT=j[1]>0?true:false}if(r[0]<6&&r[1]<6){return}if(r[0]>r[1]+5&&!k){j[1]=m[1];o[1]=0;this._dir=o[0]>0?"left":"right"}else{if(r[1]>r[0]+5&&k){j[0]=m[0];o[0]=0;this._dir=o[1]>0?"up":"down"}}this._moved=true;this._move(j);if(i-this._time>300){this._time=i;this._startPos=m}var g=k?this._pos[1]:this._pos[0];this.fire("onScrolling",{"":-g,outBound:this._outBound})},doTouchEnd_:function(t){b=null;var n=t.domEvent.originalEvent,k=this.$n();this.domUnlisten_(k,"onTouchMove","doTouchMove_").domUnlisten_(k,"onTouchEnd","doTouchEnd_");if(n.touches.length!=0){return}var s=n.changedTouches[0],j={dist:0,time:0},g={dist:0,time:0},l=(n.timeStamp||Date.now())-this._time,q=newPos=this._pos,m=this._startPos,i;if(l<300){var o,r;if(newPos[0]){o=newPos[0]-m[0];r=this._caveW-this._viewW+q[0];j=this._calcMomentum(o,l,-q[0],r,this._viewW)}if(newPos[1]){o=newPos[1]-m[1];r=this._caveH-this._viewH+q[1];g=this._calcMomentum(o,l,-q[1],r,this._viewH)}newPos=[q[0]+j.dist,q[1]+g.dist];var f=this._maxCaveX,e=this._maxCaveY;if((q[0]>0&&newPos[0]>0)||(q[0]<f&&newPos[0]<f)){j={dist:0,time:0}}if((q[1]>0&&newPos[1]>0)||(q[1]<e&&newPos[1]<e)){g={dist:0,time:0}}}if(j.dist||g.dist){i=Math.max(Math.max(j.time,g.time),10);this._scrollTo(d(newPos[0]),d(newPos[1]),i);return}var h=this.isVertical_()?this._pos[1]:this._pos[0];this.fire("onScroll",{"":-h,outBound:this._outBound});this._resetPos(100)},removeChildHTML_:function(e){this.$supers("removeChildHTML_",arguments);jq(e.uuid+"-chdex",zk).remove()},encloseChildHTML_:function(k,i){var f=[],g=this.isVertical_()?"inner":"inner";f.push('<div id="',k.uuid,'-chdex" class="',this.$s("inner"),'">');k.redraw(f);f.push("</div>");if(!i){return f.join("")}for(var h=0,e=f.length;h<e;++h){i.push(f[h])}},_chdextr:function(e){return e.$n("chdex")||e.$n()},insertChildHTML_:function(g,e,f){if(e){jq(this._chdextr(e)).before(this.encloseChildHTML_(g))}else{jq(this.$n("cave")).append(this.encloseChildHTML_(g))}g.bind(f)},beforeChildrenFlex_:function(k){this._shallSize=false;k._flexFixed=true;var w=this.isVertical_(),y=[],e=[],r=this.$n(),o=k.getParentSize_(r),n=o.height,t=o.width,q=zk(r),v=this.firstChild,i;if(!zk.mounting){this._resetBoxSize(w)}if(q.hasVScroll()){t-=(i=jq.scrollbarWidth())}if(q.hasHScroll()){n-=i||jq.scrollbarWidth()}for(;v;v=v.nextSibling){if(v.isVisible()){var j=v,A=j.$n(),x=zk(A),m=A.parentNode,g=zk(m);if(v&&v._nvflex){if(j!==k){j._flexFixed=true}if(j._vflex=="min"){j.fixMinFlex_(A,"h");m.style.height=jq.px0(A.offsetHeight+x.marginHeight()+g.padBorderHeight());if(w){n-=m.offsetHeight+g.marginHeight()}}else{y.push(j);if(w){n=n-g.marginHeight()}}}else{if(w){n-=m.offsetHeight+g.marginHeight()}}if(j&&j._nhflex){if(j!==k){j._flexFixed=true}if(j._hflex=="min"){j.fixMinFlex_(A,"w");m.style.width=jq.px0(A.offsetWidth+x.marginWidth()+g.padBorderWidth());if(!w){t-=m.offsetWidth+g.marginWidth()}}else{e.push(j);if(!w){t=t-g.marginWidth()}}}else{if(!w){t-=m.offsetWidth+g.marginWidth()}}}}while(y.length>0){var j=y.shift(),z=(w?(j._nvflex*n):n)|0,l=j.$n().offsetTop,s=z-(l>0?l*2:0),u=j.$n("chdex"),h=zk(u).padBorderHeight();j.setFlexSize_({height:s-h});j._vflexsz=z-h;u.style.height=jq.px0(z)}while(e.length>0){var j=e.shift(),f=(w?t:(j._nhflex*t))|0,u=j.$n("chdex"),h=zk(u).padBorderWidth();j.setFlexSize_({width:f-h});j._hflexsz=f-h;u.style.width=jq.px0(f)}k.parent.afterChildrenFlex_(k);k._flexFixed=false;return false}})})();