(function(){var a=zk.ie<11?1193046:16777216,b={};zk.override(zul.grid.Grid.prototype,b,{_firstLoad:true,_totalSize:0,_avgrowhgh:21,_offset:0,_lastoffset:0,_limit:20,_bufpad:21*50,_loadpad:21*10,_viewtop:0,_lasttop:0,_totalhgh:null,_rowshgh:null,_topPad:0,_itop:0,_ibottom:0,$init:function(){b.$init.apply(this,arguments);this._padsz={}},domPad_:function(c,d){if(this._grid$rod){c.push('<div id="',this.uuid,d,'" style="font-size:0px;display:none;overflow:hidden;width:1px;"></div>')}},setResetDataLoader:function(){this._currentTop=this._currentLeft=this._topPad=this._lasttop=0;this.refreshBar_(false,true);if(this._nativebar&&this.ebody){this.ebody.scrollTop=0}},setTotalSize:function(c){if(this._grid$rod){this._totalSize=c;if(!this._scrolling&&this.desktop){this._initPadSizes();if(zk.ie<11){this._doScroll()}}}},_fireOnScrollPos:function(c){if(this._grid$rod&&!this.inPagingMold()){clearTimeout(this._timeoutId);this._timeoutId=setTimeout(this.proxy(this._scrollPage),c>=0?c:300)}else{b._fireOnScrollPos.apply(this,arguments)}},_onRender:function(){if(b._onRender.apply(this,arguments)){return true}if(this._grid$rod&&!this.inPagingMold()&&this._firstLoad){this._firstLoad=false;if(this.initRodSize){this._bufpad=this.initRodSize/2*21}this._initPadSizes();this.refreshBar_()}},_setPadSize:function(g,d,f){this._padsz[d]=f;var e=g.style;e.display=f?"block":"none";var c=['<table id="',this.uuid,"-",d,'-tbl"',">"];if(!zk.webkit){while(true){c.push('<tr style="height:',Math.min(f,a),'px"><td></td></tr>');f-=a;if(f<=0){break}}}else{while(true){c.push('<tr><td style="height:',Math.min(f,a),'px"></td></tr>');f-=a;if(f<=0){break}}}c.push("</table>");jq(g).empty().append(c.join(""))},_initPadSizes:function(){if(this.inPagingMold()){return}var o,f;if(!(o=this.rows)||!(f=o.$n())){return}var g=o.nChildren,k=this._rowshgh=f.offsetHeight,m=this._totalSize,j=this.ebody;this._avgrowhgh=g>0?((k/g)|0):21;this._ibottom=this._offset+g;if(this._topPad<0){this._topPad=this._offset*this._avgrowhgh}if(this._offset==0){this._topPad=0}var c=this._topPad;var i=m*this._avgrowhgh-k-c;if(i<0){if(this._offset>0){c+=i}i=0;if(c<0){c=0}}else{if(m<=this._ibottom){i=0}}if(this._topPad!=c){this.fire("onTopPad",{topPad:this._topPad=c})}this._setPadSize(this.$n("tpad"),"tpad",c);this._setPadSize(this.$n("bpad"),"bpad",i);this._totalhgh=j.scrollHeight;this._itop=this._offset;var n=j.offsetHeight;this._limit=(((n+this._bufpad*2)/this._avgrowhgh)|0)+2;if(!this._viewtop&&!this._lasttop&&this._currentTop>0){this._viewtop=this._lasttop=this._currentTop}if(!this._lastoffset&&this._offset>0){this._lastoffset=this._offset}if(this._totalSize>this._ibottom){var e=this._viewtop=this._currentTop,h=e+n,d=o.lastChild.$n(),l=d?this._rowScrollBottom(d):c;if(h>l&&this._lastoffset==this._itop){this.fire("onDataLoading",{offset:this._itop,limit:this._limit})}}this.refreshBar_()},_rowScrollBottom:function(c){return c.offsetTop+c.offsetHeight-(this.ebodytbl.offsetParent==c.offsetParent?this.ebodytbl.offsetTop:0)},_rowOffsetTop:function(c){var d=this.rows.$n();return c.offsetTop-(d.offsetParent==c.offsetParent?d.offsetTop:0)},_scrollPage:function(){var k,q;if(!(k=this.rows)||!(q=k.$n())){return}var r=this.ebody,f=this._viewtop=zul.mesh.Scrollbar.getScrollPosV(this),t=f+r.offsetHeight;var g=this._padsz.tpad,n=this._lasttop,u=g,o=this._rowshgh=q.offsetHeight,h=u+o;if(f!=n){var v=f-this._bufpad,s=t+this._bufpad,l=f-this._loadpad,i=t+this._loadpad;if(v<0){v=0}if(l<0){l=0}if(s>this._totalhgh){s=this._totalhgh-(zk.ie<11?1:0)}if(i>this._totalhgh){i=this._totalhgh-(zk.ie<11?1:0)}if(f>n){if(h<i){var d=this._itop;if(h<v){d=this._ibottom+(((v-h)/this._avgrowhgh)|0)}else{var c=v-g;if(c>=0){var p=this._ibottom-1;d=0;for(var e=k.lastChild;e;e=e.previousSibling,--p){var m=this._rowOffsetTop(e.$n());if(m<c){d=p;break}}}}if(d>=this._totalSize){d=this._totalSize-this._limit}if(d<0||f==0){d=0}if(d!=this._lastoffset||(this._totalSize>this._ibottom&&k.nChildren<this._limit)){this._lastoffset=d;this._lasttop=f;this.fire("onDataLoading",{offset:d,limit:this._limit},{rtags:{onDataLoading:1}})}}}else{if(u>=l||(v==0&&this._lastoffset>0)){var d=v==0?0:(this._itop-((u-v)/this._avgrowhgh)|0);if(d>=this._totalSize){d=this._totalSize-this._limit}if(d<0){d=0}if(d!=this._lastoffset){this._lastoffset=d;this._lasttop=f;this.fire("onDataLoading",{offset:d,limit:this._limit},{rtags:{onDataLoading:1}})}}}}this._currentTop=f;this.fire("onScrollPos",{top:this._currentTop,left:this._currentLeft})},setScrollPads_:function(o){delete this._scrolling;if(!this._grid$rod||o!=this._lastoffset){return}this._inScrollPads=true;var m,u;if(!(m=this.rows)||!(u=m.$n())){return}var f=this.$n("tpad"),n=this.$n("bpad"),l=this._padsz.tpad,c=this._padsz.bpad,p=this._rowshgh,r=this._itop,d=this._ibottom,q=this._rowshgh=u.offsetHeight,g=this._totalSize,h=this._itop=o,e=this._ibottom=h+m.nChildren,w=this.ebody;if(h>r){if(h>=d){l=l+p+((o-d)*this._avgrowhgh|0)}else{var t=m.firstChild;for(var s=h;s<d&&t;++s){t=t.nextSibling}l=l+p-(t?this._rowOffsetTop(t.$n()):q)}}else{if(h<r){if(e<=r){l=l-((r-o)*this._avgrowhgh|0)}else{var t=m.lastChild;for(var s=e-1;s>r&&t;--s){t=t.previousSibling}l=l-(t?this._rowOffsetTop(t.$n()):q)}}}if(o==0){l=0}else{if(l==0){l=o*this._avgrowhgh}}c=this._totalhgh-q-l;var j=c>0&&e>=g;if(j){c=0}if(c<0){j=true;c=((g-e)*this._avgrowhgh)|0}if(this._topPad!=l){this.fire("onTopPad",{topPad:this._topPad=l})}this._setPadSize(f,"tpad",l<0?0:l);this._setPadSize(n,"bpad",c<0?0:c);var i=this._viewtop;if(i>=(this._avgrowhgh*g-this._bufpad)&&i!=w.scrollTop){w.scrollTop=this._currentTop=i}if(l<0||c<0||j){this._totalhgh=w.scrollHeight}if(!zk.mobile&&zul.mesh.Scrollbar.getScrollPosV(this)!=this._lasttop){this._fireOnScrollPos()}}})})();