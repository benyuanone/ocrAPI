zkex.grid.Group=zk.$extends(zul.grid.Row,{_open:true,setOpen:(function(a,b){return function(c,d){var e=this[a];this[a]=c;if(e!==c||(d&&d.force)){this.__fname__=a.substring(1);b.apply(this,arguments);delete this.__fname__}return this}})("_open",(function(a){this._openItem(a,true);if(a&&this.parent){this.parent.stripe()}})),getOpen:_zkf$=function(){return this._open},isOpen:_zkf$,getItems:function(){var b=[];for(var a=this.nextSibling;a&&!a.$instanceof(zkex.grid.Group);a=a.nextSibling){b.push(a)}return b},getItemCount:function(){return this.getItems().length},getLabel:function(){return this.firstChild!=null&&this.firstChild.$instanceof(zul.wgt.Label)?this.firstChild.getValue():null},domImage_:function(){var a=this._open?this.getIconOpenClass_()+" "+this.$s("icon-open"):this.getIconCloseClass_()+" "+this.$s("icon-close");return'<span id="'+this.uuid+'-img" class="'+this.$s("icon")+'"><i class="'+a+'"></i></span>'},domContent_:function(){var a=this.getLabel(),b=this.domImage_();return a?b+" ":b},isStripeable_:function(){return false},encloseChildHTML_:function(c){var b=c.out||[],d=c.child,a=d.$instanceof(zul.wgt.Cell);if(!a){b.push('<td id="',d.uuid,'-chdextr"',this._childAttrs(d,c.index),'><div id="',d.uuid,'-cell" class="',c.zclass,'-content">');if(d==this.firstChild){b.push(this.domContent_())}}d.redraw(b);if(!a){b.push("</div></td>")}if(!c.out){return b.join("")}},_doImgClick:function(a){var b=!this.isOpen(),c=this.getGrid();if(!b){zWatch.fireDown("onHide",this.parent)}this._openItem(b);if(b||c.getModel()){if(b){this.parent.stripe()}}if(b){zUtl.fireShown(this.parent)}a.stop()},_openItem:function(d,g){this._open=d;var c=this.$n("img");if(c){var h=jq(c.firstChild),b=this.getIconOpenClass_()+" "+this.$s("icon-open"),e=this.getIconCloseClass_()+" "+this.$s("icon-close");h.removeClass(d?e:b).addClass(d?b:e)}var a=this.getGrid(),i=a?a.inPagingMold():false,f=a?a.isModel():false;if(!i){this._openItemNow(d)}if(a){if(!f){a.refreshBar_(true)}a._shallShowScrollbar=true}if(!g){this.fire("onOpen",{open:d},{toServer:i||f||a._grid$rod})}},_openItemNow:function(b){var a=this.$n();if(a){for(var c,a=a.nextSibling;a&&(c=zk.Widget.$(a))&&!zkex.grid.Group.isInstance(c)&&!zkex.grid.Groupfoot.isInstance(c);a=a.nextSibling){if(c.desktop&&c.isVisible()){jq(a)[b?"show":"hide"]()}}}},beforeParentChanged_:function(e){if(!e){var d=this.parent,b=d.hasGroup();if(b){for(var a=d.getGroups(),f=d.getGroupCount();--f>=0;){if(a[f]==this){b=a[--f];break}}}if(b){this._unbindafter=[function(){if(b){b._openItem(b.isOpen(),true)}}]}else{this._openItemNow(true,true)}}this.$supers("beforeParentChanged_",arguments)},onChildAdded_:function(a){this.$supers("onChildAdded_",arguments);if(this.firstChild==a){this.rerender()}},bind_:function(){this.$supers(zkex.grid.Group,"bind_",arguments);var a=this.$n(),f=this.$n("img"),h=a.parentNode.parentNode,d=h.firstChild;if(f){var c=zk.mobile?"onTouchstart":"onClick";this.domListen_(f,c,"_doImgClick")}if(!this._spans&&d&&jq.nodeName(d,"colgroup")){var g=0;for(var b=d.firstChild;b;b=b.nextSibling){if(zk(b).isVisible()){g++}}for(var j=a.cells,e=j.length;e--;){g-=j[e].colSpan}if(g>0&&a.cells.length){a.cells[a.cells.length-1].colSpan+=g}}},unbind_:function(d,c){var a=this.$n("img");if(a){var b=zk.mobile?"onTouchstart":"onClick";this.domUnlisten_(a,b,"_doImgClick")}if(this._unbindafter&&this._unbindafter.length){c.push(this._unbindafter.pop())}this._unbindafter=null;this.$supers(zkex.grid.Group,"unbind_",arguments)},getIconOpenClass_:function(){return"z-icon-angle-down"},getIconCloseClass_:function(){return"z-icon-angle-right"}});