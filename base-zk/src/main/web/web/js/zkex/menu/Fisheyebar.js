(function(b){var a=b.body;zkex.menu.Fisheyebar=zk.$extends(zul.Widget,{_itemWidth:50,_itemHeight:50,_itemMaxWidth:200,_itemMaxHeight:200,_itemPadding:10,_orient:"horizontal",_attachEdge:"center",_labelEdge:"bottom",$init:function(){this.$supers("$init",arguments);this.units=2;this.subts=0.5;this.box={x:-1,y:-1,l:-1,r:-1,t:-1,b:-1}},setItemWidth:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_itemWidth",(_zkf=function(){if(this.$n()){this.syncAttr();this.onSize()}})),getItemWidth:_zkf$=function(){return this._itemWidth},isItemWidth:_zkf$,setItemHeight:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_itemHeight",(_zkf)),getItemHeight:_zkf$=function(){return this._itemHeight},isItemHeight:_zkf$,setItemMaxWidth:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_itemMaxWidth",(_zkf)),getItemMaxWidth:_zkf$=function(){return this._itemMaxWidth},isItemMaxWidth:_zkf$,setItemMaxHeight:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_itemMaxHeight",(_zkf)),getItemMaxHeight:_zkf$=function(){return this._itemMaxHeight},isItemMaxHeight:_zkf$,setItemPadding:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_itemPadding",(_zkf)),getItemPadding:_zkf$=function(){return this._itemPadding},isItemPadding:_zkf$,setOrient:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_orient",(_zkf)),getOrient:_zkf$=function(){return this._orient},isOrient:_zkf$,setAttachEdge:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_attachEdge",(_zkf)),getAttachEdge:_zkf$=function(){return this._attachEdge},isAttachEdge:_zkf$,setLabelEdge:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_labelEdge",(_zkf)),getLabelEdge:_zkf$=function(){return this._labelEdge},isLabelEdge:_zkf$,bind_:function(){this.$supers(zkex.menu.Fisheyebar,"bind_",arguments);this._init();zWatch.listen({onSize:this,onResponse:this})},unbind_:function(){zWatch.unlisten({onSize:this,onResponse:this});jq(b).unbind("zmousemove",this._onMouseMove).unbind("mouseout",this._onBodyOut);this.pbox=this._onMouseMove=this._onBodyOut=null;this.$supers(zkex.menu.Fisheyebar,"unbind_",arguments)},onResponse:function(){if(this.desktop&&this._shallSync){this.syncAttr();this.onSize();this._shallSync=false}},onChildAdded_:function(c){this.$supers("onChildAdded_",arguments);this._shallSync=true},onChildRemoved_:function(c){this.$supers("onChildRemoved_",arguments);this._shallSync=true},_init:function(){var d=this.$n();zk(d).disableSelection();this.syncAttr();var c=this;if(!this._onMouseMove){this._onMouseMove=function(f){var e=f.pageX,h=f.pageY;if((e>=c.box.l)&&(e<=c.box.r)&&(h>=c.box.t)&&(h<=c.box.b)){if(!c.active){c.active=true;c.onSize()}c._calc(e-c.box.l,h-c.box.t)}else{if(c.active){c.active=false;c._calc(-1,-1)}else{if(c._bodyX&&c._bodyY&&e<=c._bodyX+30&&e>=c._bodyX-30&&h<=c._bodyY+30&&h>=c._bodyY-30){return}c._bodyX=e;c._bodyY=h;var g=jq.now();if(!c._timer||c._timer<g){c._timer=g+1500;c.onSize()}}}}}if(!this._onBodyOut){this._onBodyOut=function(h){var f=h.pageX,m=h.pageY,k=zk(a).revisedOffset(),i=k[1],e=i+a.offsetHeight,g=k[0],j=g+a.offsetWidth;if(f>=g&&f<=j&&m>=i&&m<=e){return}c.active=false;c._calc(-1,-1)}}jq(b).bind("zmousemove",this._onMouseMove).mouseout(this._onBodyOut)},getAttachEdge:function(){var c=this._attachEdge;return c=="center"||(this.isHor&&(c=="left"||c=="right"))||(!this.isHor&&(c=="top"||c=="bottom"))?"center":c},getLabelEdge:function(){var c=this._labelEdge;if(c=="center"||(this.isHor&&(c=="left"||c=="right"))){c="top"}else{if(!this.isHor&&(c=="top"||c=="bottom")){c="left"}}return c},getProximitybox:function(){var d=(this.units-this.subts),e=this.iw*d,g=e,f=this.ih*d,c=f;switch(this.aEdge){case"left":e=0;break;case"right":g=0;break;case"top":f=0;break;case"bottom":c=0;break;default:e/=2;g/=2;f/=2;c/=2}return{l:e,r:g,t:f,b:c}},syncAttr:function(){if(!this.$n()){return}this.icnt=this.nChildren;this.iw=this._itemWidth;this.ih=this._itemHeight;this.imw=this._itemMaxWidth;this.imh=this._itemMaxHeight;this.isHor=(this._orient=="horizontal");this.aEdge=this.getAttachEdge();this.lEdge=this.getLabelEdge();this.pbox=this.getProximitybox();this.ip=this._itemPadding;var z=(this.isHor?this.icnt:1)*this.iw,d=(this.isHor?1:this.icnt)*this.ih;this.tw=this.pbox.l+this.pbox.r+z;this.th=this.pbox.t+this.pbox.b+d;for(var v=0;v<this.icnt;v++){var g=this.getChildAt(v),e=g.$n(),A=g.$n("img"),l=this.iw*(this.isHor?v:0),j=this.ih*(this.isHor?0:v),m=e.style,f=A.style;e.cenX=l+(this.iw/2);e.cenY=j+(this.ih/2);var p=this.isHor?this.iw:this.ih,o=this.units*p,h=this.isHor?e.cenX:e.cenY,t=this.isHor?this.pbox.l:this.pbox.t,c=this.isHor?this.pbox.r:this.pbox.b,w=this.isHor?z:d;var k=o,u=o;if(k>h+t){k=h+t}if(u>(w-h+c)){u=w-h+c}e.effectRangeLeft=k/p;e.effectRangeRght=u/p;m.left=l+"px";m.top=j+"px";m.width=this.iw+"px";m.height=this.ih+"px";f.left=this.ip+"%";f.top=this.ip+"%";f.width=(100-2*this.ip)+"%";f.height=(100-2*this.ip)+"%"}var q=this.$n();q.style.width=z+"px";q.style.height=d+"px";this.onSize()},_calc:function(s,p){if(s<=this.box.x+4&&s>=this.box.x-4&&p<=this.box.y+4&&p>=this.box.y-4){return}this.box.x=s;this.box.y=p;if(this.icnt<=0){return}var q,k,e,r;if(this.isHor){q=s;k=this.pbox.l;e=this.iw;r=1*this.imw}else{q=p;k=this.pbox.t;e=this.ih;r=1*this.imh}var m=((q-k)/e)-this.subts,o=(r/e)-this.subts;if(o>this.units){o=this.units}var h=0,d=this.aEdge;switch(d){case"bottom":var n=(p-this.pbox.t)/this.ih;h=(n>this.subts)?1:p/(this.pbox.t+(this.ih/2));break;case"top":var n=(p-this.pbox.t)/this.ih;h=(n<this.subts)?1:(this.th-p)/(this.pbox.b+(this.ih/2));break;case"right":var n=(s-this.pbox.l)/this.iw;h=(n>this.subts)?1:s/(this.pbox.l+(this.iw/2));break;case"left":var n=(s-this.pbox.l)/this.iw;h=(n<this.subts)?1:(this.tw-s)/(this.pbox.r+(this.iw/2));break;default:h=this.isHor?(p/(this.th)):(h=s/(this.tw));if(h>this.subts){h=1-h}h*=2}for(var g=0;g<this.icnt;g++){var c=this.getChildAt(g),j=this._weighAt(m,g,c.$n());if(j<0){j=0}this._setItemSize(c.$n(),j*h)}var l=Math.round(m),f=0;if(m<0){l=0}else{if(m>this.icnt-1){l=this.icnt-1}else{f=(m-l)*((this.isHor?this.iw:this.ih)-this.getChildAt(l).$n().sizeMain)}}this._fixEl(l,f)},_weighAt:function(d,e,g){var f=Math.abs(d-e),c=((d-e)>0)?g.effectRangeRght:g.effectRangeLeft;return(f>c)?0:(1-f/c)},_setItemSize:function(i,f){f*=1;var d=Math.round(this.iw+((this.imw-this.iw)*f)),e=Math.round(this.ih+((this.imh-this.ih)*f));if(this.isHor){i.sizeMain=i.sizeW=d;i.sizeH=e;var g=0;if(this.aEdge=="top"){g=(i.cenY-(this.ih/2))}else{if(this.aEdge=="bottom"){g=(i.cenY-(e-(this.ih/2)))}else{g=(i.cenY-(e/2))}}i.usualX=Math.round(i.cenX-(d/2));i.style.top=g+"px";i.style.left=i.usualX+"px"}else{i.sizeW=d;i.sizeMain=i.sizeH=e;var c=0;if(this.aEdge=="left"){c=i.cenX-(this.iw/2)}else{if(this.aEdge=="right"){c=i.cenX-(d-(this.iw/2))}else{c=i.cenX-(d/2)}}i.style.left=c+"px";i.usualY=Math.round(i.cenY-(e/2));i.style.top=i.usualY+"px"}i.style.width=d+"px";i.style.height=e+"px"},_fixEl:function(f,g){var k=0,j=this.getChildAt(f),h=j.$n();if(this.isHor){k=Math.round(h.usualX+g);h.style.left=k+"px"}else{k=Math.round(h.usualY+g);h.style.top=k+"px"}this._fixLab(j);for(var c=k,d=f;--d>=0;){var j=this.getChildAt(d);var h=j.$n();c-=h.sizeMain;if(this.isHor){h.style.left=c+"px"}else{h.style.top=c+"px"}this._fixLab(j)}for(var e=k,d=f;++d<this.icnt;){var j=this.getChildAt(d);var h=j.$n();e+=this.getChildAt(d-1).$n().sizeMain;if(this.isHor){h.style.left=e+"px"}else{h.style.top=e+"px"}this._fixLab(j)}},_fixLab:function(k){var j=k.$n(),e=k.$n("label"),c=0,i=0,g=this.lEdge,f=k._mh+e.offsetHeight,d=k._mw+e.offsetWidth;if(!zk(e).isVisible()){return}switch(g){case"top":c=Math.round((j.sizeW/2)-(d/2));i=-f;break;case"bottom":c=Math.round((j.sizeW/2)-(d/2));i=j.sizeH;break;case"left":c=-d;i=Math.round((j.sizeH/2)-(f/2));break;case"right":c=j.sizeW;i=Math.round((j.sizeH/2)-(f/2));break}e.style.left=c+"px";e.style.top=i+"px"},onSize:function(){var c=zk(this.$n()).revisedOffset();this.box.l=c[0]-this.pbox.l;this.box.t=c[1]-this.pbox.t;this.box.r=this.box.l+this.tw;this.box.b=this.box.t+this.th}})})(document);