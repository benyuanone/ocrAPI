(function(){function a(){this._picker=new zkex.inp.Colorpicker({_wgt:this});this._palette=new zkex.inp.Colorpalette({_wgt:this});this.appendChild(this._picker);this.appendChild(this._palette)}var b=zkex.inp.Colorbox=zk.$extends(zk.Widget,{_open:false,$init:function(){this.$supers("$init",arguments);this.afterInit(a);this._currColor=new zkex.inp.Color()},setDisabled:(function(c,d){return function(e,f){var g=this[c];this[c]=e;if(g!==e||(f&&f.force)){this.__fname__=c.substring(1);d.apply(this,arguments);delete this.__fname__}return this}})("_disabled",(function(c){var d=this.$n();if(d){var c=this._disabled;this[c?"domUnlisten_":"domListen_"](d,"onClick","_doBtnClick");jq(d)[c?"addClass":"removeClass"](this.$s("disabled"))}})),getDisabled:_zkf$=function(){return this._disabled},isDisabled:_zkf$,setColor:function(e){var d=this._currColor.getHex();if(d!=e){this._currColor.setHex(e);var c=this.$n("currcolor");if(c){c.style.backgroundColor=this._currColor.getHex()}}},getColor:function(){return this._currColor.getHex()},setValue:function(c){this.setColor(c)},getValue:function(){return this.getColor()},_syncPopupPosition:function(){zk(this.$n("pp")).position(this.$n(),this._getPosition())},_getPosition:function(){var c=this.parent;if(!c){return}if(c.$instanceof(zul.wgt.Toolbar)){return"vertical"==c.getOrient()?"end_before":"after_start"}return"after_start"},_syncShadow:function(c){if(!this._popupShadow){this._popupShadow=new zk.eff.Shadow(this.$n("pp"),{stackup:zk.useStackup})}this._popupShadow.sync()},_hideShadow:function(c){var d=this._popupShadow;if(d){d.hide()}},bind_:function(){this.$supers("bind_",arguments);if(!this._disabled){this.domListen_(this.$n(),zk.android?"onTouchstart":"onClick","_doBtnClick")}var c=this.$n("palette-btn"),e=this.$n("picker-btn");if(c){this._palette.$n().style.display="none";this.domListen_(c,"onClick","openPalette")}if(e){this._picker.$n().style.display="none";this.domListen_(e,"onClick","openPicker")}var d=this.$n("currcolor");if(d){d.style.backgroundColor=this._currColor.getHex()}},unbind_:function(){if(!this._disabled){this.domUnlisten_(this.$n(),zk.android?"onTouchstart":"onClick","_doBtnClick")}if(this._popupShadow){this._popupShadow.destroy()}this.domUnlisten_(this.$n("palette-btn"),"onClick","openPalette").domUnlisten_(this.$n("picker-btn"),"onClick","openPicker");this.$supers("unbind_",arguments)},domClass_:function(d){var c=this.$supers("domClass_",arguments);if(!d||!d.zclass){if(this._disabled){c+=" "+this.$s("disabled")}}return c},_doBtnClick:function(c){var d=this._open;if(this._open=!d){this.openPopup()}else{this.closePopup()}c.stop()},openPopup:function(){this._open=true;var e=this.$n(),c=this.$n("pp"),d=this._picker.$n();this.closePicker();this.openPalette();c.style.width=c.style.height="auto";c.style.display="block";jq(c).zk.makeVParent();this._syncPopupPosition();this._syncShadow()},closePopup:function(){this._open=false;var d=this.$n(),c=this.$n("pp");c.style.display="none";jq(c).zk.undoVParent();this._hideShadow()},onChange:function(c){this.$n("currcolor").style.backgroundColor=c;this._currColor.setHex(c);this.fire("onChange",{color:c},{toServer:true},150)},onHide:function(){this._open=false;var d=this.$n(),c=this.$n("pp");c.style.display="none";jq(c).zk.undoVParent();this._hideShadow()},openPalette:function(){var d=this._palette.$n();if(!d){return}var e=this._picker.$n();if(e&&zk(e).isVisible()){this.closePicker()}d.style.display="block";jq(this.$n("pp")).addClass(this._palette.$s("popup"));this._syncPopupPosition();this._syncShadow();var c=this._palette;c.setColor(this._currColor.getHex());c.onShow()},closePalette:function(d){var c=this._palette.$n();if(!c||!zk(c).isVisible()){return}c.style.display="none";jq(this.$n("pp")).removeClass(this._palette.$s("popup"));if(d){this.closePopup()}},openPicker:function(){var c=this._picker.$n();if(!c){return}this.closePalette();c.style.display="block";jq(this.$n("pp")).addClass(this._picker.$s("popup"));this._syncPopupPosition();this._syncShadow();var d=this._picker;d.setColor(this._currColor.getHex());d.onShow()},closePicker:function(){var c=this._picker.$n();if(!c||!zk(c).isVisible()){return}c.style.display="none";jq(this.$n("pp")).removeClass(this._picker.$s("popup"))}})})();