(function(){function c(l,k,h){var n=l.control,j=n.getNewColor(),i=l.node,m=zk(n.$n("bar")).revisedOffset(),o=k[1]-m[1];i.style.top=jq.px(o);j.setHSV((256-o)*359.99/255,j.getSaturation(),j.getValue());n._colorChanged("arrows");return false}function f(k,j){var i=0,h=255,l=j[1];l=l<i?i:l>h?h:l;return[j[0],l]}function b(l,k,h){var m=l.control,j=m._newColor,i=m.$n("arrows"),n=zk.parseInt(i.style.top);j.setHSV((256-n)*359.99/255,j.getSaturation(),j.getValue());m._colorChanged("arrows")}function a(n,r,p){var q=n.control,l=q.getNewColor(),k=zk(q.$n("overlay")).revisedOffset(),j=n.node,o=r[0]-k[0],m=r[1]-k[1],i=o/255,h=1-m/255;j.style.left=jq.px(o);j.style.top=jq.px(m);l.setHSV(l.getHue(),i,h);q._colorChanged();return false}function e(l,k){var j=0,i=255,h=k[0],m=k[1];h=h<j?j:h>i?i:h;m=m<j?j:m>i?i:m;return[h,m]}function g(m,q,o){var p=m.control,k=p._newColor,j=p.$n("circle"),n=zk.parseInt(j.style.left),l=zk.parseInt(j.style.top),i=n/255,h=1-(l/255);k.setHSV(k.getHue(),i,h);p._colorChanged()}var d=zkex.inp.Colorpicker=zk.$extends(zk.Widget,{_inpChanged:false,$init:function(h){this.$supers("$init",arguments);this._currColor=new zkex.inp.Color();this._newColor=new zkex.inp.Color();this._wgt=h._wgt},setColor:(function(h,i){return function(j,k){var l=this[h];this[h]=j;if(l!==j||(k&&k.force)){this.__fname__=h.substring(1);i.apply(this,arguments);delete this.__fname__}return this}})("_color",(function(h){this._currColor.setHex(h);this._newColor.setHex(h)})),getColor:_zkf$=function(){return this._color},isColor:_zkf$,getNewColor:function(){return this._newColor},getInputType:function(){return"text"},redraw:function(h){var i=this.uuid;h.push("<div",this.domAttrs_(),">",'<div id="',i,'-gradient" class="',this.$s("gradient"),'">','<div id="',i,'-overlay" class="',this.$s("overlay"),'"></div>','<div id="',i,'-circle" class="',this.$s("circle"),'"></div></div>','<div id="',i,'-hue" class="',this.$s("hue"),'">','<div id="',i,'-bar" class="',this.$s("bar"),'"></div>','<div id="',i,'-arrows" class="',this.$s("arrows"),'"></div></div>','<div id="',i,'-color" class="',this.$s("color"),'">','<div id="',i,'-newcolor" class="',this.$s("newcolor"),'"></div>','<div id="',i,'-currcolor" class="',this.$s("current"),'"></div></div>','<div id="',i,'-hex" class="',this.$s("hex"),'" >','<label id="',i,'-hex-text" class="',this.$s("text"),'">Hex:</label>','<input id="',i,'-hex-inp" class="',this.$s("input"),'" type="text" size="8" maxlength="7"></input></div>','<div id="',i,'-r" class="',this.$s("r"),'">','<label id="',i,'-r-text" class="',this.$s("text"),'">R.</label>','<input id="',i,'-r-inp" class="',this.$s("input"),'" type="',this.getInputType(),'" size="3" maxlength="3"></input></div>','<div id="',i,'-g" class="',this.$s("g"),'">','<label id="',i,'-g-text" class="',this.$s("text"),'">G.</label>','<input id="',i,'-g-inp" class="',this.$s("input"),'" type="',this.getInputType(),'" size="3" maxlength="3"></input></div>','<div id="',i,'-b" class="',this.$s("b"),'">','<label id="',i,'-b-text" class="',this.$s("text"),'">B.</label>','<input id="',i,'-b-inp" class="',this.$s("input"),'" type="',this.getInputType(),'" size="3" maxlength="3"></input></div>','<div id="',i,'-h" class="',this.$s("h"),'">','<label id="',i,'-h-text" class="',this.$s("text"),'">H.</label>','<input id="',i,'-h-inp" class="',this.$s("input"),'" type="',this.getInputType(),'" size="3" maxlength="3"></input></div>','<div id="',i,'-s" class="',this.$s("s"),'">','<label id="',i,'-s-text" class="',this.$s("text"),'">S.</label>','<input id="',i,'-s-inp" class="',this.$s("input"),'" type="',this.getInputType(),'" size="3" maxlength="3"></input></div>','<div id="',i,'-v" class="',this.$s("v"),'">','<label id="',i,'-v-text" class="',this.$s("text"),'">V.</label>','<input id="',i,'-v-inp" class="',this.$s("input"),'" type="',this.getInputType(),'" size="3" maxlength="3"></input></div>','<button type="button" id="',i,'-ok-btn" class="',this.$s("button"),'"><i class="',this.$s("icon"),' z-icon-check"></i></button>',"</div>")},bind_:function(){this.$supers(d,"bind_",arguments);var j=this.$n("arrows"),h=this.$n("hue"),i=this.$n("circle"),k=this.$n("gradient");this._arrowsDrag=new zk.Draggable(this,j,{constraint:"vertical",handle:h,ignoredrag:c,snap:f,change:b,endeffect:zk.$void});this._circleDrag=new zk.Draggable(this,i,{handle:k,ignoredrag:a,snap:e,change:g,endeffect:zk.$void});this.domListen_(this.$n("ok-btn"),"onClick","_doOk");this.domListen_(this.$n("hex-inp"),"onBlur","_doHexChange");zWatch.listen({onShow:this,onFloatUp:this,onHide:this})},unbind_:function(){if(this._arrowsDrag){this._arrowsDrag.destroy();this._arrowsDrag=null}if(this._circleDrag){this._circleDrag.destroy();this._circleDrag=null}this.domUnlisten_(this.$n("ok-btn"),"onClick","_doOk");this.domUnlisten_(this.$n("hex-inp"),"onBlur","_doHexChange");zWatch.unlisten({onShow:this,onFloatUp:this,onHide:this});this.$supers(d,"unbind_",arguments)},onHide:function(){this._wgt.onHide()},onFloatUp:function(h){if(!zUtl.isAncestor(this.parent,h.origin)){this._wgt.onHide()}},onShow:function(){this._colorChanged("onShow")},_doHexChange:function(){this._newColor.setHex(this.$n("hex-inp").value);this._colorChanged("inp")},_colorChanged:function(h){var q=this._newColor,p=q.getHue(),k=q.getSaturation(),j=q.getValue(),l=q.getHex(),r=q.getRGB();this.$n("r-inp").value=r[0];this.$n("g-inp").value=r[1];this.$n("b-inp").value=r[2];this.$n("hex-inp").value=l;this.$n("h-inp").value=Math.round(p);this.$n("s-inp").value=Math.round(k*100);this.$n("v-inp").value=Math.round(j*100);if(h=="arrows"||h=="inp"||h=="onShow"){var n=new zkex.inp.Color();n.setHSV(p,1,1);this.$n("overlay").style.backgroundColor=n.getHex()}if(h=="inp"||h=="onShow"){var i=this.$n("arrows"),o=(256-p*255/359.99),u=o<0?0:o>255?255:o,m=this.$n("circle"),t=k*255,s=(1-j)*255;i.style.top=jq.px(u);m.style.top=jq.px(s);m.style.left=jq.px(t)}if(h=="onShow"){this.$n("currcolor").style.backgroundColor=this._currColor.getHex()}this.$n("newcolor").style.backgroundColor=l},_doInpChanged:function(h){if(!this._inpChanged||h.domTarget==this.$n("hex-inp")){return}var m=h.domTarget,k=this._newColor,l=k.getRGB(),j=k.getHue(),i=k.getSaturation(),n=k.getValue(),o=zk.parseInt(m.value);switch(m.id.split("-")[1]){case"r":k.setRGB(o,l[1],l[2]);break;case"g":k.setRGB(l[0],o,l[2]);break;case"b":k.setRGB(l[0],l[1],o);break;case"h":k.setHSV(o,i,n);break;case"s":k.setHSV(j,o/100,n);break;case"v":k.setHSV(j,i,o/100);break}this._colorChanged("inp");this._inpChanged=false},doKeyDown_:function(h){var k=h.keyCode,j=h.domTarget,i=this.$n("hex-inp");switch(k){case 48:case 96:case 49:case 97:case 50:case 98:case 51:case 99:case 52:case 100:case 53:case 101:case 54:case 102:case 55:case 103:case 56:case 104:case 57:case 105:case 37:case 39:case 46:case 8:break;case 13:if(j==i){this._doHexChange();return}break;case 9:break;default:if(j==i&&"ABCDEF".indexOf(String.fromCharCode(k))>=0){break}h.stop();return}this._inpChanged=true},doKeyUp_:function(h){this._doInpChanged(h)},_doOk:function(h){var i=this._wgt;i.onChange(this._newColor.getHex());i.onHide(true);h.stop()}})})();